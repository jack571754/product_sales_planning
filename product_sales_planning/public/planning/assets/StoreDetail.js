var it=Object.defineProperty,ut=Object.defineProperties;var dt=Object.getOwnPropertyDescriptors;var Ke=Object.getOwnPropertySymbols;var ct=Object.prototype.hasOwnProperty,ft=Object.prototype.propertyIsEnumerable;var Je=(s,a,e)=>a in s?it(s,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[a]=e,j=(s,a)=>{for(var e in a||(a={}))ct.call(a,e)&&Je(s,e,a[e]);if(Ke)for(var e of Ke(a))ft.call(a,e)&&Je(s,e,a[e]);return s},Qe=(s,a)=>ut(s,dt(a));var H=(s,a,e)=>new Promise((p,n)=>{var c=u=>{try{i(e.next(u))}catch(h){n(h)}},v=u=>{try{i(e.throw(u))}catch(h){n(h)}},i=u=>u.done?p(u.value):Promise.resolve(u.value).then(c,v);i((e=e.apply(s,a)).next())});import{c as w,o as d,a as l,d as W,m as pt,u as mt,b as C,L as gt,e as z,n as K,r as R,f as E,g as vt,t as S,h as m,i as t,j as Ze,k as ht,l as yt,p as B,q as bt,s as ie,w as f,v as X,P as Ee,x as Xe,y as Me,z as We,D as _t,A as xt,F as wt,B as Le,C as kt,E as et,G as Ct,H as Ne,I as Re,T as $t,_ as ne,J as St,K as Be,M as P,N as Ot,O as It,Q as Dt,R as tt,S as T,U as M,V as ge,W as $e,X as Pt,Y as zt,Z as me,$ as ae,a0 as ze,a1 as se,a2 as N,a3 as Et,a4 as Bt,a5 as At,a6 as Ft,a7 as Ge}from"./index.js";import{u as Vt}from"./useHandsontable.js";const qt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Tt(s,a){return d(),w("svg",qt,[...a[0]||(a[0]=[l("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[l("circle",{cx:"12",cy:"12",r:"10"}),l("path",{d:"m15 9l-6 6m0-6l6 6"})],-1)])])}const Mt={name:"lucide-circle-x",render:Tt},Lt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Nt(s,a){return d(),w("svg",Lt,[...a[0]||(a[0]=[l("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[l("circle",{cx:"12",cy:"12",r:"10"}),l("path",{d:"m9 12l2 2l4-4"})],-1)])])}const Rt={name:"lucide-circle-check",render:Nt},Ut={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function jt(s,a){return d(),w("svg",Ut,[...a[0]||(a[0]=[l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m21.73 18l-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3M12 9v4m0 4h.01"},null,-1)])])}const Ht={name:"lucide-triangle-alert",render:jt},Kt={class:"text-ink-gray-9"},Jt={key:0,class:"text-ink-gray-6 prose-sm"},Te=W({__name:"Alert",props:pt({title:{},theme:{},variant:{default:"subtle"},description:{},dismissable:{type:Boolean,default:!0}},{modelValue:{default:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(s){const a=mt(s,"modelValue"),e=C(()=>{const c={yellow:"bg-surface-amber-2",blue:"bg-surface-blue-2",red:"bg-surface-red-2",green:"bg-surface-green-2"};return n.variant=="outline"?"border border-outline-gray-3":n.theme?c[n.theme]:"bg-surface-gray-2"}),p=C(()=>{const c={yellow:{component:Ht,css:"text-ink-amber-3"},blue:{component:gt,css:"text-ink-blue-3"},red:{component:Mt,css:"text-ink-red-3"},green:{component:Rt,css:"text-ink-green-3"}};return n.theme?c[n.theme]:null}),n=s;return(c,v)=>a.value?(d(),w("div",{key:0,role:"alert",class:K([e.value,"grid grid-cols-[auto_1fr_auto] gap-3 rounded-md px-4 py-3.5 text-base items-start"])},[R(c.$slots,"icon",{},()=>[p.value?(d(),E(vt(p.value.component),{key:0,class:K(["size-4",p.value.css])},null,8,["class"])):z("",!0)]),l("div",{class:K(["grid gap-2",{"col-span-2":!c.$slots.icon&&!p.value}])},[l("span",Kt,S(n.title),1),R(c.$slots,"description",{},()=>[n.description?(d(),w("p",Jt,S(n.description),1)):z("",!0)])],2),n.dismissable?(d(),w("button",{key:0,onClick:v[0]||(v[0]=i=>a.value=!1)},[m(t(Ze),{class:"size-4"})])):z("",!0),R(c.$slots,"footer")],2)):z("",!0)}}),[ue,Qt]=ht("DialogRoot");var Xt=W({inheritAttrs:!1,__name:"DialogRoot",props:{open:{type:Boolean,required:!1,default:void 0},defaultOpen:{type:Boolean,required:!1,default:!1},modal:{type:Boolean,required:!1,default:!0}},emits:["update:open"],setup(s,{emit:a}){const e=s,n=yt(e,"open",a,{defaultValue:e.defaultOpen,passive:e.open===void 0}),c=B(),v=B(),{modal:i}=bt(e);return Qt({open:n,modal:i,openModal:()=>{n.value=!0},onOpenChange:u=>{n.value=u},onOpenToggle:()=>{n.value=!n.value},contentId:"",titleId:"",descriptionId:"",triggerElement:c,contentElement:v}),(u,h)=>R(u.$slots,"default",{open:t(n),close:()=>n.value=!1})}}),Wt=Xt,Gt=W({__name:"DialogClose",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"}},setup(s){const a=s;ie();const e=ue();return(p,n)=>(d(),E(t(Ee),X(a,{type:p.as==="button"?"button":void 0,onClick:n[0]||(n[0]=c=>t(e).onOpenChange(!1))}),{default:f(()=>[R(p.$slots,"default")]),_:3},16,["type"]))}}),Yt=Gt,Zt=W({__name:"DialogContentImpl",props:{forceMount:{type:Boolean,required:!1},trapFocus:{type:Boolean,required:!1},disableOutsidePointerEvents:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(s,{emit:a}){const e=s,p=a,n=ue(),{forwardRef:c,currentElement:v}=ie();return n.titleId||(n.titleId=Xe(void 0,"reka-dialog-title")),n.descriptionId||(n.descriptionId=Xe(void 0,"reka-dialog-description")),Me(()=>{n.contentElement=v,We()!==document.body&&(n.triggerElement.value=We())}),(i,u)=>(d(),E(t(wt),{"as-child":"",loop:"",trapped:e.trapFocus,onMountAutoFocus:u[5]||(u[5]=h=>p("openAutoFocus",h)),onUnmountAutoFocus:u[6]||(u[6]=h=>p("closeAutoFocus",h))},{default:f(()=>[m(t(_t),X({id:t(n).contentId,ref:t(c),as:i.as,"as-child":i.asChild,"disable-outside-pointer-events":i.disableOutsidePointerEvents,role:"dialog","aria-describedby":t(n).descriptionId,"aria-labelledby":t(n).titleId,"data-state":t(xt)(t(n).open.value)},i.$attrs,{onDismiss:u[0]||(u[0]=h=>t(n).onOpenChange(!1)),onEscapeKeyDown:u[1]||(u[1]=h=>p("escapeKeyDown",h)),onFocusOutside:u[2]||(u[2]=h=>p("focusOutside",h)),onInteractOutside:u[3]||(u[3]=h=>p("interactOutside",h)),onPointerDownOutside:u[4]||(u[4]=h=>p("pointerDownOutside",h))}),{default:f(()=>[R(i.$slots,"default")]),_:3},16,["id","as","as-child","disable-outside-pointer-events","aria-describedby","aria-labelledby","data-state"])]),_:3},8,["trapped"]))}}),st=Zt,es=W({__name:"DialogContentModal",props:{forceMount:{type:Boolean,required:!1},trapFocus:{type:Boolean,required:!1},disableOutsidePointerEvents:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(s,{emit:a}){const e=s,p=a,n=ue(),c=Le(p),{forwardRef:v,currentElement:i}=ie();return kt(i),(u,h)=>(d(),E(st,X(j(j({},e),t(c)),{ref:t(v),"trap-focus":t(n).open.value,"disable-outside-pointer-events":!0,onCloseAutoFocus:h[0]||(h[0]=x=>{var _;x.defaultPrevented||(x.preventDefault(),(_=t(n).triggerElement.value)==null||_.focus())}),onPointerDownOutside:h[1]||(h[1]=x=>{const _=x.detail.originalEvent,O=_.button===0&&_.ctrlKey===!0;(_.button===2||O)&&x.preventDefault()}),onFocusOutside:h[2]||(h[2]=x=>{x.preventDefault()})}),{default:f(()=>[R(u.$slots,"default")]),_:3},16,["trap-focus"]))}}),ts=es,ss=W({__name:"DialogContentNonModal",props:{forceMount:{type:Boolean,required:!1},trapFocus:{type:Boolean,required:!1},disableOutsidePointerEvents:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(s,{emit:a}){const e=s,n=Le(a);ie();const c=ue(),v=B(!1),i=B(!1);return(u,h)=>(d(),E(st,X(j(j({},e),t(n)),{"trap-focus":!1,"disable-outside-pointer-events":!1,onCloseAutoFocus:h[0]||(h[0]=x=>{var _;x.defaultPrevented||(v.value||(_=t(c).triggerElement.value)==null||_.focus(),x.preventDefault()),v.value=!1,i.value=!1}),onInteractOutside:h[1]||(h[1]=x=>{var g;x.defaultPrevented||(v.value=!0,x.detail.originalEvent.type==="pointerdown"&&(i.value=!0));const _=x.target;((g=t(c).triggerElement.value)==null?void 0:g.contains(_))&&x.preventDefault(),x.detail.originalEvent.type==="focusin"&&i.value&&x.preventDefault()})}),{default:f(()=>[R(u.$slots,"default")]),_:3},16))}}),as=ss,ls=W({__name:"DialogContent",props:{forceMount:{type:Boolean,required:!1},disableOutsidePointerEvents:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup(s,{emit:a}){const e=s,p=a,n=ue(),c=Le(p),{forwardRef:v}=ie();return(i,u)=>(d(),E(t(et),{present:i.forceMount||t(n).open.value},{default:f(()=>[t(n).modal.value?(d(),E(ts,X({key:0,ref:t(v)},j(j(j({},e),t(c)),i.$attrs)),{default:f(()=>[R(i.$slots,"default")]),_:3},16)):(d(),E(as,X({key:1,ref:t(v)},j(j(j({},e),t(c)),i.$attrs)),{default:f(()=>[R(i.$slots,"default")]),_:3},16))]),_:3},8,["present"]))}}),os=ls,ns=W({__name:"DialogDescription",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"p"}},setup(s){const a=s;ie();const e=ue();return(p,n)=>(d(),E(t(Ee),X(a,{id:t(e).descriptionId}),{default:f(()=>[R(p.$slots,"default")]),_:3},16,["id"]))}}),at=ns,rs=W({__name:"DialogOverlayImpl",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(s){const a=ue();return Ct(!0),ie(),(e,p)=>(d(),E(t(Ee),{as:e.as,"as-child":e.asChild,"data-state":t(a).open.value?"open":"closed",style:{"pointer-events":"auto"}},{default:f(()=>[R(e.$slots,"default")]),_:3},8,["as","as-child","data-state"]))}}),is=rs,us=W({__name:"DialogOverlay",props:{forceMount:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},setup(s){const a=ue(),{forwardRef:e}=ie();return(p,n)=>{var c;return(c=t(a))!=null&&c.modal.value?(d(),E(t(et),{key:0,present:p.forceMount||t(a).open.value},{default:f(()=>[m(is,X(p.$attrs,{ref:t(e),as:p.as,"as-child":p.asChild}),{default:f(()=>[R(p.$slots,"default")]),_:3},16,["as","as-child"])]),_:3},8,["present"])):z("v-if",!0)}}}),ds=us,cs=W({__name:"DialogPortal",props:{to:{type:null,required:!1},disabled:{type:Boolean,required:!1},defer:{type:Boolean,required:!1},forceMount:{type:Boolean,required:!1}},setup(s){const a=s;return(e,p)=>(d(),E(t($t),Ne(Re(a)),{default:f(()=>[R(e.$slots,"default")]),_:3},16))}}),fs=cs,ps=W({__name:"DialogTitle",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"h2"}},setup(s){const a=s,e=ue();return ie(),(p,n)=>(d(),E(t(Ee),X(a,{id:t(e).titleId}),{default:f(()=>[R(p.$slots,"default")]),_:3},16,["id"]))}}),lt=ps;const ms={name:"Loading",props:{text:{type:String,default:"Loading..."}},components:{LoadingIndicator:St}},gs={class:"flex items-center text-base text-ink-gray-4"};function vs(s,a,e,p,n,c){const v=Be("LoadingIndicator");return d(),w("div",gs,[m(v,{class:"-ml-1 mr-2 h-3 w-3"}),P(" "+S(e.text),1)])}const hs=ne(ms,[["render",vs]]),ys={name:"Card",props:{title:{type:String},subtitle:{type:String},loading:{type:Boolean}},components:{LoadingText:hs}},bs={class:"flex flex-col rounded-lg border bg-white px-6 py-5 shadow"},_s={class:"flex items-baseline justify-between"},xs={class:"flex items-baseline space-x-2"},ws={key:0,class:"flex items-center space-x-2"},ks={class:"text-xl font-semibold"},Cs={key:0,class:"flex items-center space-x-2"},$s={key:0,class:"mt-1.5 text-base text-gray-600"},Ss={key:1,class:"mt-4 flex flex-auto flex-col items-center justify-center rounded-md"},Os={key:2,class:"mt-4 flex-auto overflow-auto"};function Is(s,a,e,p,n,c){const v=Be("LoadingText");return d(),w("div",bs,[l("div",_s,[l("div",xs,[s.$slots["actions-left"]?(d(),w("div",ws,[R(s.$slots,"actions-left")])):z("",!0),l("h2",ks,S(e.title),1)]),s.$slots.actions?(d(),w("div",Cs,[R(s.$slots,"actions")])):z("",!0)]),e.subtitle?(d(),w("p",$s,S(e.subtitle),1)):z("",!0),e.loading?(d(),w("div",Ss,[m(v)])):s.$slots.default?(d(),w("div",Os,[R(s.$slots,"default")])):z("",!0)])}const be=ne(ys,[["render",Is]]),Ds=["disabled","id","checked"],Ps=["for"],Ye=W({__name:"Checkbox",props:{size:{default:"sm"},label:{},disabled:{type:Boolean},padding:{type:Boolean,default:!1},modelValue:{type:[Boolean,Number]},id:{}},setup(s){var v;const a=s,e=Ot(),p=(v=a.id)!=null?v:It(),n=C(()=>[{sm:"text-base font-medium",md:"text-lg font-medium"}[a.size],a.disabled?"text-ink-gray-4":"text-ink-gray-8","select-none"]),c=C(()=>{let i=a.disabled?"border-outline-gray-2 bg-surface-menu-bar text-ink-gray-3":"border-outline-gray-4 text-ink-gray-9 hover:border-outline-gray-5 focus:ring-offset-0 focus:border-outline-gray-8 active:border-outline-gray-6 transition",u=a.disabled?"":a.padding?"focus:ring-0":"hover:shadow-sm focus:ring-0 focus-visible:ring-2 focus-visible:ring-outline-gray-3 active:bg-surface-gray-2",h={sm:"w-3.5 h-3.5",md:"w-4 h-4"}[a.size];return[i,u,h]});return(i,u)=>(d(),w("div",{class:K(["inline-flex space-x-2 rounded transition",{"px-2.5 py-1.5":s.padding&&s.size==="sm","px-3 py-2":s.padding&&s.size==="md","focus-within:bg-surface-gray-2 focus-within:ring-2 focus-within:ring-outline-gray-3 hover:bg-surface-gray-3 active:bg-surface-gray-4":s.padding&&!s.disabled}])},[l("input",X({class:["rounded-sm mt-[1px] bg-surface-white",c.value],type:"checkbox",disabled:s.disabled,id:t(p),checked:!!s.modelValue,onChange:u[0]||(u[0]=h=>i.$emit("update:modelValue",h.target.checked))},t(e)),null,16,Ds),s.label?(d(),w("label",{key:0,class:K(["block",n.value]),for:t(p)},S(s.label),11,Ps)):z("",!0)],2))}}),zs={class:"bg-surface-modal px-4 pb-6 pt-5 sm:px-6"},Es={class:"flex"},Bs={class:"w-full flex-1"},As={class:"mb-6 flex items-center justify-between"},Fs={class:"flex items-center space-x-2"},Vs={class:"text-2xl font-semibold leading-6 text-ink-gray-9"},qs={class:"text-p-base text-ink-gray-7"},Ts={key:0,class:"px-4 pb-7 pt-4 sm:px-6"},Ms={class:"space-y-2"},Ls=W({__name:"Dialog",props:{modelValue:{type:Boolean},options:{default:()=>({})},disableOutsideClickToClose:{type:Boolean,default:!1}},emits:["update:modelValue","close","after-leave"],setup(s,{emit:a}){const e=s,p=a,n=C(()=>{let g=e.options.actions;return g!=null&&g.length?g.map(I=>{let k=Dt(Qe(j({},I),{loading:!1,onClick:I.onClick?()=>H(this,null,function*(){k.loading=!0;try{if(I.onClick){let q=()=>{console.warn("Value passed to onClick is a context object. Please use context.close() instead of context() to close the dialog."),i()};q.close=i,yield I.onClick(q)}}finally{k.loading=!1}}):i}));return k}):[]}),c=C({get(){return e.modelValue},set(g){p("update:modelValue",g),g||p("close")}});function v(g){c.value=g}function i(){c.value=!1}const u=C(()=>{var I;if(!((I=e.options)!=null&&I.icon))return null;let g=e.options.icon;return typeof g=="string"&&(g={name:g}),g}),h=C(()=>{var k,q;if((k=e.options)!=null&&k.paddingTop)return"";const g=((q=e.options)==null?void 0:q.position)||"center";return{center:"justify-center",top:"pt-[20vh]"}[g]}),x=C(()=>{var g;return(g=e.options)!=null&&g.paddingTop?{paddingTop:e.options.paddingTop}:{}}),_=C(()=>{var k;const g=(k=u.value)==null?void 0:k.appearance;return g?{warning:"bg-surface-amber-2",info:"bg-surface-blue-2",danger:"bg-surface-red-2",success:"bg-surface-green-2"}[g]:"bg-surface-gray-2"}),O=C(()=>{var k;const g=(k=u.value)==null?void 0:k.appearance;return g?{warning:"text-ink-amber-3",info:"text-ink-blue-3",danger:"text-ink-red-4",success:"text-ink-green-3"}[g]:"text-ink-gray-5"});return(g,I)=>(d(),E(t(Wt),{open:c.value,"onUpdate:open":[I[3]||(I[3]=k=>c.value=k),v]},{default:f(()=>[m(t(fs),null,{default:f(()=>[m(t(ds),{class:"fixed inset-0 bg-black-overlay-200 backdrop-filter backdrop-blur-[12px] overflow-y-auto dialog-overlay outline-none","data-dialog":s.options.title,onAfterLeave:I[2]||(I[2]=k=>g.$emit("after-leave"))},{default:f(()=>[l("div",{class:K(["flex min-h-screen flex-col items-center px-4 py-4 text-center",h.value]),style:tt(x.value)},[m(t(os),{class:K(["my-8 inline-block w-full transform overflow-hidden rounded-xl bg-surface-modal text-left align-middle shadow-xl dialog-content focus-visible:outline-none",{"max-w-7xl":s.options.size==="7xl","max-w-6xl":s.options.size==="6xl","max-w-5xl":s.options.size==="5xl","max-w-4xl":s.options.size==="4xl","max-w-3xl":s.options.size==="3xl","max-w-2xl":s.options.size==="2xl","max-w-xl":s.options.size==="xl","max-w-lg":s.options.size==="lg"||!s.options.size,"max-w-md":s.options.size==="md","max-w-sm":s.options.size==="sm","max-w-xs":s.options.size==="xs"}]),onEscapeKeyDown:I[0]||(I[0]=k=>i()),onInteractOutside:I[1]||(I[1]=k=>{e.disableOutsideClickToClose&&k.preventDefault()})},{default:f(()=>[R(g.$slots,"body",{},()=>[R(g.$slots,"body-main",{},()=>[l("div",zs,[l("div",Es,[l("div",Bs,[R(g.$slots,"body-header",{},()=>[l("div",As,[l("div",Fs,[u.value?(d(),w("div",{key:0,class:K(["flex h-7 w-7 flex-shrink-0 items-center justify-center rounded-full",_.value])},[m(T,{name:u.value.name,class:K(["h-4 w-4",O.value]),"aria-hidden":"true"},null,8,["name","class"])],2)):z("",!0),m(t(lt),{as:"header"},{default:f(()=>[R(g.$slots,"body-title",{},()=>[l("h3",Vs,S(s.options.title||"Untitled"),1)],!0)]),_:3})]),m(t(Yt),{"as-child":""},{default:f(()=>[m(t(M),{variant:"ghost",onClick:i},{icon:f(()=>[m(t(Ze),{class:"h-4 w-4 text-ink-gray-9"})]),_:1})]),_:1})])],!0),R(g.$slots,"body-content",{},()=>[s.options.message?(d(),E(t(at),{key:0,"as-child":""},{default:f(()=>[l("p",qs,S(s.options.message),1)]),_:1})):z("",!0)],!0)])])])],!0),n.value.length||g.$slots.actions?(d(),w("div",Ts,[R(g.$slots,"actions",Ne(Re({close:i})),()=>[l("div",Ms,[(d(!0),w(ge,null,$e(n.value,k=>(d(),E(t(M),X({class:"w-full",key:k.label,disabled:k.disabled},{ref_for:!0},k),{default:f(()=>[P(S(k.label),1)]),_:2},1040,["disabled"]))),128))])],!0)])):z("",!0)],!0)]),_:3},8,["class"])],6)]),_:3},8,["data-dialog"])]),_:3})]),_:3},8,["open"]))}}),Ns=ne(Ls,[["__scopeId","data-v-5e9d9e2d"]]),Ie=Ns;Ie.Title=lt;Ie.Description=at;class Rs{constructor(){this.listeners={},this.failed=!1}on(a,e){this.listeners[a]=this.listeners[a]||[],this.listeners[a].push(e)}trigger(a,e){(this.listeners[a]||[]).forEach(n=>{n.call(this,e)})}upload(a,e){return new Promise((p,n)=>{let c=new XMLHttpRequest;c.upload.addEventListener("loadstart",()=>{this.trigger("start")}),c.upload.addEventListener("progress",u=>{u.lengthComputable&&this.trigger("progress",{uploaded:u.loaded,total:u.total})}),c.upload.addEventListener("load",()=>{this.trigger("finish")}),c.addEventListener("error",()=>{this.trigger("error"),n()}),c.onreadystatechange=()=>{if(c.readyState==XMLHttpRequest.DONE){let u;if(c.status===200){let h=null;try{h=JSON.parse(c.responseText)}catch(_){h=c.responseText}let x=h.message||h;p(x)}else if(c.status===403)u=JSON.parse(c.responseText);else{this.failed=!0;try{u=JSON.parse(c.responseText)}catch(h){}}u&&u.exc&&console.error(JSON.parse(u.exc)[0]),n(u)}};const v=e.upload_endpoint||"/api/method/upload_file";c.open("POST",v,!0),c.setRequestHeader("Accept","application/json"),window.csrf_token&&window.csrf_token!=="{{ csrf_token }}"&&c.setRequestHeader("X-Frappe-CSRF-Token",window.csrf_token);let i=new FormData;a&&i.append("file",a,a.name),i.append("is_private",e.private?"1":"0"),i.append("folder",e.folder||"Home"),e.file_url&&i.append("file_url",e.file_url),e.doctype&&i.append("doctype",e.doctype),e.docname&&i.append("docname",e.docname),e.fieldname&&i.append("fieldname",e.fieldname),e.method&&i.append("method",e.method),e.type&&i.append("type",e.type),e.optimize&&(i.append("optimize","1"),e.max_width&&i.append("max_width",e.max_width.toString()),e.max_height&&i.append("max_height",e.max_height.toString())),c.send(i)})}}const Us={name:"FileUploader",props:{fileTypes:{type:[String,Array]},uploadArgs:{type:Object},validateFile:{type:Function,default:null}},data(){return{uploader:null,uploading:!1,uploaded:0,error:null,message:"",total:0,file:null,finishedUploading:!1}},computed:{progress(){let s=Math.floor(this.uploaded/this.total*100);return isNaN(s)?0:s},success(){return this.finishedUploading&&!this.error}},methods:{inputRef(){return this.$refs.input},openFileSelector(){this.$refs.input.click()},onFileAdd(s){return H(this,null,function*(){if(this.error=null,this.file=s.target.files[0],this.file&&this.validateFile)try{let a=yield this.validateFile(this.file);a&&(this.error=a)}catch(a){this.error=a}this.error||this.uploadFile(this.file)})},uploadFile(s){return H(this,null,function*(){this.error=null,this.uploaded=0,this.total=0,this.uploader=new Rs,this.uploader.on("start",()=>{this.uploading=!0}),this.uploader.on("progress",a=>{this.uploaded=a.uploaded,this.total=a.total}),this.uploader.on("error",()=>{this.uploading=!1,this.error="Error Uploading File"}),this.uploader.on("finish",()=>{this.uploading=!1,this.finishedUploading=!0}),this.uploader.upload(s,this.uploadArgs||{}).then(a=>{this.$emit("success",a)}).catch(a=>{this.uploading=!1;let e="Error Uploading File";a!=null&&a._server_messages?e=JSON.parse(JSON.parse(a._server_messages)[0]).message:a!=null&&a.exc&&(e=JSON.parse(a.exc)[0].split(`
`).slice(-2,-1)[0]),this.error=e,this.$emit("failure",a)})})}},expose:["inputRef"]},js=["accept"];function Hs(s,a,e,p,n,c){const v=Be("Button");return d(),w("div",null,[l("input",{ref:"input",type:"file",accept:e.fileTypes,class:"hidden",onChange:a[0]||(a[0]=(...i)=>c.onFileAdd&&c.onFileAdd(...i))},null,40,js),R(s.$slots,"default",Ne(Re({file:n.file,uploading:n.uploading,progress:c.progress,uploaded:n.uploaded,message:n.message,error:n.error,total:n.total,success:c.success,openFileSelector:c.openFileSelector})),()=>[m(v,{onClick:c.openFileSelector,loading:n.uploading},{default:f(()=>[P(S(n.uploading?`Uploading ${c.progress}%`:"Upload File"),1)]),_:1},8,["onClick","loading"])])])}const Ks=ne(Us,[["render",Hs]]),Js={name:"Input",inheritAttrs:!1,expose:["getInputValue"],components:{FeatherIcon:T},props:{label:{type:String},type:{type:String,default:"text",validator(s){let a=["text","number","checkbox","textarea","select","email","password","date"].includes(s);return a||console.warn(`Invalid value "${s}" for "type" prop for Input`),a}},modelValue:{type:[String,Number,Boolean,Object,Array]},inputClass:{type:[String,Array,Object]},debounce:{type:Number},options:{type:Array},disabled:{type:Boolean},rows:{type:Number,default:3},placeholder:{type:String},iconLeft:{type:String}},emits:["input","change","update:modelValue"],methods:{focus(){this.$refs.input.focus()},blur(){this.$refs.input.blur()},getInputValue(s){let a=s?s.target:this.$refs.input,e=a.value;return this.type=="checkbox"&&(e=a.checked),e}},computed:{passedInputValue(){return"value"in this.$attrs?this.$attrs.value:this.modelValue||null},inputAttributes(){let s={},a=e=>{this.$emit("input",this.getInputValue(e))};return this.debounce&&(a=Pt(a,this.debounce)),this.type=="checkbox"&&(s.checked=this.passedInputValue),Object.assign(s,this.$attrs,{onInput:a,onChange:e=>{this.$emit("change",this.getInputValue(e)),this.$emit("update:modelValue",this.getInputValue(e))}})},selectOptions(){return this.options.map(s=>typeof s=="string"?{label:s,value:s}:s).filter(Boolean)},isNormalInput(){return["text","number","checkbox","email","password","date"].includes(this.type)}}},Qs={key:0,class:"mb-2 block text-sm leading-4 text-gray-700"},Xs=["type","disabled","placeholder","value"],Ws=["placeholder","value","disabled","rows"],Gs=["disabled"],Ys=["value","disabled","selected"],Zs={key:1,class:"ml-2 inline-block text-base leading-4"};function ea(s,a,e,p,n,c){const v=Be("FeatherIcon");return d(),w("label",{class:K([e.type=="checkbox"?"flex":"block",s.$attrs.class]),style:tt(s.$attrs.style)},[e.label&&e.type!="checkbox"?(d(),w("span",Qs,S(e.label),1)):z("",!0),l("div",{class:K(["relative flex",{"items-center":c.isNormalInput||e.type=="select"}])},[e.iconLeft&&e.type!="checkbox"?(d(),E(v,{key:0,name:e.iconLeft,class:K(["absolute mx-2 h-4 w-4 text-gray-600",{"mt-2":e.type=="textarea"}])},null,8,["name","class"])):z("",!0),c.isNormalInput?(d(),w("input",X({key:1},c.inputAttributes,{class:["border-gray-400 placeholder-gray-500",[{"form-input block w-full":e.type!="checkbox","form-checkbox":e.type=="checkbox","pl-8":e.iconLeft&&e.type!="checkbox"},e.inputClass]],ref:"input",type:e.type||"text",disabled:e.disabled,placeholder:e.placeholder,value:c.passedInputValue}),null,16,Xs)):z("",!0),e.type==="textarea"?(d(),w("textarea",X({key:2},c.inputAttributes,{placeholder:e.placeholder,class:["placeholder-gray-500",["form-textarea block w-full resize-none",e.inputClass,{"pl-8":e.iconLeft}]],ref:"input",value:c.passedInputValue,disabled:e.disabled,rows:e.rows}),null,16,Ws)):z("",!0),e.type==="select"?(d(),w("select",X({key:3},c.inputAttributes,{class:["form-select block w-full",{"pl-8":e.iconLeft}],ref:"input",disabled:e.disabled}),[(d(!0),w(ge,null,$e(c.selectOptions,i=>(d(),w("option",{key:i.value,value:i.value,disabled:i.disabled||!1,selected:c.passedInputValue===i.value},S(i.label),9,Ys))),128))],16,Gs)):z("",!0)],2),e.label&&e.type=="checkbox"?(d(),w("span",Zs,S(e.label),1)):z("",!0)],6)}const ot=ne(Js,[["render",ea]]),ta={},sa={class:"spinner",viewBox:"0 0 50 50"};function aa(s,a){return d(),w("svg",sa,[...a[0]||(a[0]=[l("defs",null,[l("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%"},[l("stop",{offset:"0%","stop-color":"rgba(0,110,219,1)"}),l("stop",{offset:"100%","stop-color":"rgba(255,255,255,0)"})])],-1),l("circle",{stroke:"url(#gradient)",class:"spinner-path",cx:"25",cy:"25",r:"20",fill:"none","stroke-width":"5"},null,-1)])])}const la=ne(ta,[["render",aa],["__scopeId","data-v-5c03f65e"]]);function oa(s,a){let e=null;return function(...p){e&&clearTimeout(e),e=setTimeout(()=>{s.apply(this,p)},a)}}function na(s,a){const e=B({search:"",category:""}),p=B({currentPage:1,pageSize:50,pageSizeOptions:[20,50,100,200]}),n=B({hiddenColumns:[]}),c=B(!1),v=B(null),i=B(null),u=B(new Set),h=B(new Set),x=zt({url:"product_sales_planning.api.v1.commodity.get_store_commodity_data",params:()=>({store_id:s,task_id:a,view_mode:"multi",start:(p.value.currentPage-1)*p.value.pageSize,page_length:p.value.pageSize,search_term:e.value.search||null,brand:e.value.brand||null,category:e.value.category||null}),auto:!0,transform:o=>(console.log("API è¿”å›žçš„åŽŸå§‹æ•°æ®:",o),o?{commodities:o.data||[],months:o.months||[],store_info:o.store_info||{},task_info:o.task_info||{},can_edit:o.can_edit!==void 0?o.can_edit:!0,edit_reason:o.edit_reason||"",approval_status:o.approval_status||{},total_count:o.total_count||0}:{commodities:[],months:[],store_info:{},task_info:{},can_edit:!1,edit_reason:"",approval_status:{},total_count:0})}),_=C(()=>{const o=O.value,$=new Set,U=new Set;return o.forEach(D=>{D.mechanism&&$.add(D.mechanism),D.category&&U.add(D.category)}),{mechanisms:Array.from($).sort(),categories:Array.from(U).sort()}}),O=C(()=>{var o;return((o=x.data)==null?void 0:o.commodities)||[]}),g=C(()=>{var U,D;const o=((U=x.data)==null?void 0:U.months)||[];if(o.length)return o;const $=new Set;return(((D=x.data)==null?void 0:D.commodities)||[]).forEach(F=>{var Q;if(F!=null&&F.months)Object.keys(F.months).forEach(oe=>$.add(oe));else if(F!=null&&F.sub_date){const oe=typeof F.sub_date=="string"||(Q=F.sub_date)!=null&&Q.slice?F.sub_date.slice(0,7):null;oe&&$.add(oe)}}),Array.from($).sort()}),I=C(()=>{var o;return((o=x.data)==null?void 0:o.store_info)||{}}),k=C(()=>{var o;return((o=x.data)==null?void 0:o.task_info)||{}}),q=C(()=>{var o;return((o=x.data)==null?void 0:o.can_edit)||!1}),J=C(()=>{var o;return((o=x.data)==null?void 0:o.approval_status)||{}}),L=C(()=>{var o;return((o=x.data)==null?void 0:o.total_count)||0}),Z=C(()=>O.value),G=C(()=>O.value),Y=C(()=>Math.ceil(L.value/p.value.pageSize)||1),ee=C(()=>{const o=Z.value;let $=0;return o.forEach(U=>{U.months&&Object.values(U.months).forEach(D=>{const F=(D==null?void 0:D.quantity)||0;$+=Number(F)})}),{totalSKU:o.length,totalQuantity:$,plannedSKU:o.filter(U=>U.months?Object.values(U.months).some(D=>((D==null?void 0:D.quantity)||0)>0):!1).length}}),ve=()=>H(this,null,function*(){yield x.reload()}),le=o=>{e.value=j(j({},e.value),o),y(),p.value.currentPage=1,x.reload()},de=o=>{p.value=j(j({},p.value),o),y(),x.reload()},Oe=oa((o,$,U)=>H(this,null,function*(){c.value=!0,v.value=null;try{const D=yield me("product_sales_planning.api.v1.commodity.update_month_quantity",{store_id:s,task_id:a,code:o,month:$,quantity:U});return D&&D.status==="success"?(i.value=new Date,{success:!0,message:"ä¿å­˜æˆåŠŸ"}):(v.value=(D==null?void 0:D.message)||"ä¿å­˜å¤±è´¥",{success:!1,message:(D==null?void 0:D.message)||"ä¿å­˜å¤±è´¥"})}catch(D){return console.error("ä¿å­˜å¤±è´¥:",D),v.value=D.message||"ä¿å­˜å¤±è´¥",{success:!1,message:D.message||"ä¿å­˜å¤±è´¥"}}finally{c.value=!1}}),500),_e=o=>H(this,null,function*(){try{const U=o.map(([F,Q,oe,Ce])=>{const fe=G.value[F],pe=Q-6;return!fe||pe<0||pe>=g.value.length?null:{code:fe.commodity_code||fe.code,month:g.value[pe],quantity:Ce}}).filter(Boolean),D=yield me("product_sales_planning.api.v1.commodity.batch_update_month_quantities",{store_id:s,task_id:a,updates:JSON.stringify(U)});return D&&D.status==="success"?{success:!0,message:"æ‰¹é‡ä¿å­˜æˆåŠŸ"}:{success:!1,message:(D==null?void 0:D.message)||"æ‰¹é‡ä¿å­˜å¤±è´¥"}}catch($){return console.error("æ‰¹é‡ä¿å­˜å¤±è´¥:",$),{success:!1,message:$.message||"æ‰¹é‡ä¿å­˜å¤±è´¥"}}}),he=()=>H(this,null,function*(){try{const o=yield me("product_sales_planning.api.v1.import_export.export_commodity_data",{store_id:s,task_id:a});return o&&o.status==="success"?(window.open(o.file_url,"_blank"),{success:!0,message:`æˆåŠŸå¯¼å‡º ${o.record_count} æ¡è®°å½•`}):{success:!1,message:(o==null?void 0:o.message)||"å¯¼å‡ºå¤±è´¥"}}catch(o){return console.error("å¯¼å‡ºå¤±è´¥:",o),{success:!1,message:o.message||"å¯¼å‡ºå¤±è´¥"}}}),xe=()=>{const o=[{data:"__selected",title:"",type:"checkbox",width:50,className:"htCenter htMiddle",readOnly:!q.value},{data:"name1",title:"å•†å“åç§°",readOnly:!0,width:250,className:"htLeft htMiddle"},{data:"code",title:"ç¼–ç ",readOnly:!0,width:120},{data:"specifications",title:"è§„æ ¼",readOnly:!0,width:100},{data:"brand",title:"å“ç‰Œ",readOnly:!0,width:100},{data:"category",title:"ç±»åˆ«",readOnly:!0,width:100}];return g.value.forEach($=>{o.push({data:$,title:$,type:"numeric",readOnly:!q.value,width:100,numericFormat:{pattern:"0,0"}})}),o},we=()=>{const o=["é€‰æ‹©","å•†å“åç§°","ç¼–ç ","è§„æ ¼","å“ç‰Œ","ç±»åˆ«"];return g.value.forEach($=>{o.push($)}),o},ke=()=>{const o=G.value.map(($,U)=>{const D={__selected:u.value.has(U),name1:$.commodity_name||$.name1,code:$.commodity_code||$.code,specifications:$.specifications||"",brand:$.brand||"",category:$.category||""};return g.value.forEach(F=>{var Ce,fe,pe,De;const Q=(Ce=$.months)==null?void 0:Ce[F];let oe=0;!Q&&$.sub_date&&(typeof $.sub_date=="string"||(fe=$.sub_date)!=null&&fe.slice?$.sub_date.slice(0,7):null)===F&&(oe=$.quantity||0),D[F]=(De=(pe=Q==null?void 0:Q.quantity)!=null?pe:oe)!=null?De:0}),D});return console.log("ðŸ”„ transformDataForTable:",{paginatedCount:G.value.length,monthsCount:g.value.length,resultCount:o.length,sampleRow:o[0],sampleItem:G.value[0]}),o},te=C(()=>h.value.size),ye=C(()=>h.value.size>0),ce=o=>{u.value=new Set(o);const $=new Set;o.forEach(U=>{const D=G.value[U];if(D){const F=D.commodity_code||D.code;F&&$.add(F)}}),h.value=$},y=()=>{u.value=new Set,h.value=new Set},r=()=>H(this,null,function*(){if(h.value.size===0)return{success:!1,message:"è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„å•†å“"};try{const o=Array.from(h.value),$=yield me("product_sales_planning.api.v1.commodity.batch_delete_by_codes",{store_id:s,task_id:a,codes:JSON.stringify(o)});return $&&$.status==="success"?(y(),yield ve(),{success:!0,message:$.message||`æˆåŠŸåˆ é™¤ ${$.count} æ¡è®°å½•`}):{success:!1,message:($==null?void 0:$.message)||"åˆ é™¤å¤±è´¥"}}catch(o){return console.error("æ‰¹é‡åˆ é™¤å¤±è´¥:",o),{success:!1,message:o.message||"åˆ é™¤å¤±è´¥"}}});return{filters:e,pagination:p,columnSettings:n,rawCommodities:O,filteredCommodities:Z,paginatedCommodities:G,months:g,storeInfo:I,taskInfo:k,canEdit:q,approvalStatus:J,statistics:ee,totalPages:Y,totalCount:L,loading:C(()=>x.loading),error:C(()=>x.error),isSaving:c,saveError:v,lastSaveTime:i,filterOptions:_,selectedRows:u,selectedCodes:h,selectedCount:te,hasSelection:ye,refreshData:ve,updateFilters:le,updatePagination:de,saveMonthQuantity:Oe,batchSaveChanges:_e,exportToExcel:he,generateColumns:xe,generateHeaders:we,transformDataForTable:ke,updateSelectedRows:ce,clearSelection:y,batchDeleteSelected:r}}const ra={class:"flex flex-wrap gap-4 items-end"},ia={class:"flex-1 min-w-[240px]"},ua={class:"w-56"},da={class:"flex items-center gap-2"},ca={key:0,class:"mt-3 flex flex-wrap gap-2"},fa={__name:"FilterPanel",props:{filters:{type:Object,default:()=>({search:"",category:""})},filterOptions:{type:Object,default:()=>({mechanisms:[],categories:[]})},loading:{type:Boolean,default:!1}},emits:["update:filters"],setup(s,{emit:a}){const e=s,p=a,n=B(j({},e.filters)),c=C(()=>{var x;const h=((x=e.filterOptions)==null?void 0:x.categories)||[];return[{label:"å…¨éƒ¨",value:""},...h.map(_=>({label:_,value:_}))]}),v=C(()=>{let h=0;return n.value.search&&(h+=1),n.value.category&&(h+=1),h});ae(()=>e.filters,h=>{n.value=j({},h)},{deep:!0});const i=()=>{p("update:filters",j({},n.value))},u=()=>{n.value={search:"",category:""},i()};return(h,x)=>(d(),E(t(be),{class:"p-4"},{default:f(()=>[l("div",ra,[l("div",ia,[m(t(ot),{modelValue:n.value.search,"onUpdate:modelValue":[x[0]||(x[0]=_=>n.value.search=_),i],label:"æœç´¢å•†å“",disabled:s.loading,placeholder:"è¾“å…¥å•†å“ç¼–ç æˆ–åç§°..."},{prefix:f(()=>[m(t(T),{name:"search",class:"w-4 h-4 text-gray-400"})]),_:1},8,["modelValue","disabled"])]),l("div",ua,[m(t(ze),{modelValue:n.value.category,"onUpdate:modelValue":[x[1]||(x[1]=_=>n.value.category=_),i],label:"åˆ†ç±»",options:c.value,disabled:s.loading,placeholder:"å…¨éƒ¨"},null,8,["modelValue","options","disabled"])]),l("div",da,[m(t(M),{variant:"subtle",theme:"gray","icon-left":"rotate-ccw",loading:s.loading,onClick:u},{default:f(()=>[...x[2]||(x[2]=[P(" é‡ç½® ",-1)])]),_:1},8,["loading"]),v.value>0?(d(),E(t(se),{key:0,theme:"blue",size:"sm"},{default:f(()=>[P(" å·²åº”ç”¨ "+S(v.value)+" é¡¹ç­›é€‰ ",1)]),_:1})):z("",!0)])]),v.value>0?(d(),w("div",ca,[n.value.search?(d(),E(t(se),{key:0,theme:"gray",size:"sm"},{default:f(()=>[P(" æœç´¢: "+S(n.value.search),1)]),_:1})):z("",!0),n.value.category?(d(),E(t(se),{key:1,theme:"gray",size:"sm"},{default:f(()=>[P(" åˆ†ç±»: "+S(n.value.category),1)]),_:1})):z("",!0)])):z("",!0)]),_:1}))}},pa={class:"stats-cards grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},ma={class:"flex items-center justify-between"},ga={class:"text-sm text-gray-500 mb-1"},va={__name:"StatsCards",props:{statistics:{type:Object,default:()=>({totalSKU:0,plannedSKU:0,totalQuantity:0})}},setup(s){const a=s,e=n=>n?n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0",p=C(()=>[{label:"æ€» SKU æ•°",value:e(a.statistics.totalSKU),icon:"grid",color:"text-gray-900",iconColor:"text-blue-600",bg:"bg-blue-50"},{label:"å·²è§„åˆ’ SKU",value:e(a.statistics.plannedSKU),icon:"check-circle",color:"text-green-600",iconColor:"text-green-600",bg:"bg-green-50"},{label:"æ€»è®¡åˆ’é‡",value:e(a.statistics.totalQuantity),icon:"trending-up",color:"text-purple-600",iconColor:"text-purple-600",bg:"bg-purple-50"}]);return(n,c)=>(d(),w("div",pa,[(d(!0),w(ge,null,$e(p.value,v=>(d(),E(t(be),{class:"p-4",key:v.label},{default:f(()=>[l("div",ma,[l("div",null,[l("div",ga,S(v.label),1),l("div",{class:K(["text-2xl font-bold",v.color])},S(v.value),3)]),l("div",{class:K(["w-12 h-12 rounded-full flex items-center justify-center",v.bg])},[m(t(T),{name:v.icon,class:K(["w-6 h-6",v.iconColor])},null,8,["name","class"])],2)])]),_:2},1024))),128))]))}},ha={class:"flex items-center gap-2"},ya={class:"text-sm text-gray-600"},ba={class:"flex items-center gap-2"},_a={class:"flex items-center gap-1"},xa={key:1,class:"px-2 text-gray-500"},wa={__name:"PaginationControls",props:{currentPage:{type:Number,default:1},pageSize:{type:Number,default:50},totalItems:{type:Number,default:0},totalPages:{type:Number,default:1},pageSizeOptions:{type:Array,default:()=>[20,50,100,200]}},emits:["update:currentPage","update:pageSize"],setup(s,{emit:a}){const e=s,p=a,n=B(e.pageSize),c=C(()=>e.totalItems===0?0:(e.currentPage-1)*e.pageSize+1),v=C(()=>{const _=e.currentPage*e.pageSize;return e.totalItems===0?0:_>e.totalItems?e.totalItems:_}),i=C(()=>(e.pageSizeOptions||[]).map(_=>({label:`${_}`,value:_}))),u=C(()=>{const _=[],O=e.totalPages,g=e.currentPage;if(O<=7)for(let I=1;I<=O;I++)_.push(I);else if(g<=4){for(let I=1;I<=5;I++)_.push(I);_.push("..."),_.push(O)}else if(g>=O-3){_.push(1),_.push("...");for(let I=O-4;I<=O;I++)_.push(I)}else{_.push(1),_.push("...");for(let I=g-1;I<=g+1;I++)_.push(I);_.push("..."),_.push(O)}return _}),h=_=>{_>=1&&_<=e.totalPages&&_!==e.currentPage&&p("update:currentPage",_)},x=()=>{p("update:pageSize",n.value),p("update:currentPage",1)};return ae(()=>e.pageSize,_=>{n.value=_}),(_,O)=>(d(),E(t(be),{class:"p-4 flex flex-wrap items-center justify-between gap-3"},{default:f(()=>[l("div",ha,[O[5]||(O[5]=l("span",{class:"text-sm text-gray-600"},"æ¯é¡µæ˜¾ç¤º",-1)),m(t(ze),{modelValue:n.value,"onUpdate:modelValue":[O[0]||(O[0]=g=>n.value=g),x],options:i.value,size:"sm"},null,8,["modelValue","options"]),O[6]||(O[6]=l("span",{class:"text-sm text-gray-600"},"æ¡",-1))]),l("div",ya," æ˜¾ç¤º "+S(c.value)+" - "+S(v.value)+" æ¡ï¼Œå…± "+S(s.totalItems)+" æ¡ ",1),l("div",ba,[m(t(M),{variant:"ghost",theme:"gray","icon-left":"chevrons-left",disabled:s.currentPage===1,onClick:O[1]||(O[1]=g=>h(1))},null,8,["disabled"]),m(t(M),{variant:"ghost",theme:"gray","icon-left":"chevron-left",disabled:s.currentPage===1,onClick:O[2]||(O[2]=g=>h(s.currentPage-1))},null,8,["disabled"]),l("div",_a,[(d(!0),w(ge,null,$e(u.value,g=>(d(),w(ge,{key:g},[g!=="..."?(d(),E(t(M),{key:0,onClick:I=>h(g),size:"sm",theme:g===s.currentPage?"blue":"gray",variant:g===s.currentPage?"solid":"ghost"},{default:f(()=>[P(S(g),1)]),_:2},1032,["onClick","theme","variant"])):(d(),w("span",xa,"..."))],64))),128))]),m(t(M),{variant:"ghost",theme:"gray","icon-left":"chevron-right",disabled:s.currentPage===s.totalPages,onClick:O[3]||(O[3]=g=>h(s.currentPage+1))},null,8,["disabled"]),m(t(M),{variant:"ghost",theme:"gray","icon-left":"chevrons-right",disabled:s.currentPage===s.totalPages,onClick:O[4]||(O[4]=g=>h(s.totalPages))},null,8,["disabled"])])]),_:1}))}},ka={class:"space-y-4"},Ca={class:"flex items-center justify-between"},$a={class:"border border-gray-100 rounded-lg p-4 bg-gray-50"},Sa={class:"flex items-center justify-between mb-2"},Oa={key:0,class:"mt-2 text-sm text-gray-600"},Ia={key:1,class:"mt-2 text-sm text-red-600"},Da={key:0,class:"mt-2"},Pa={key:0,class:"mt-2 bg-red-50 border border-red-100 rounded p-3"},za={class:"text-sm text-red-700 space-y-1 max-h-40 overflow-y-auto"},Ea={__name:"ProductImportDialog",props:{show:{type:Boolean,default:!1},storeId:{type:String,required:!0},taskId:{type:String,required:!0}},emits:["close","success"],setup(s,{emit:a}){const e=s,p=a,n=B(!1),c=B(!1),v=B(null),i=B(null),u=B(null),h=C({get:()=>e.show,set:k=>{k||I()}}),x=()=>H(this,null,function*(){c.value=!0;try{const k=yield me("product_sales_planning.api.v1.import_export.download_import_template");k&&k.status==="success"?window.open(k.file_url,"_blank"):N.error((k==null?void 0:k.msg)||"æ¨¡æ¿ç”Ÿæˆå¤±è´¥")}catch(k){N.error(k.message||"æ¨¡æ¿ç”Ÿæˆå¤±è´¥")}finally{c.value=!1}}),_=k=>{i.value=null,v.value=(k==null?void 0:k.message)||k,u.value=null},O=k=>{i.value=(k==null?void 0:k.message)||"æ–‡ä»¶ä¸Šä¼ å¤±è´¥",v.value=null},g=()=>H(this,null,function*(){var q,J;const k=((q=v.value)==null?void 0:q.file_url)||((J=v.value)==null?void 0:J.url);if(!k){N.error("è¯·å…ˆä¸Šä¼  Excel æ–‡ä»¶");return}n.value=!0,u.value=null;try{const L=yield me("product_sales_planning.api.v1.import_export.import_commodity_data",{store_id:e.storeId,task_id:e.taskId,file_url:k});L&&L.status==="success"?(u.value={success:!0,message:L.msg||"å¯¼å…¥æˆåŠŸ",errors:L.errors||[]},N.success(u.value.message),p("success"),I()):(u.value={success:!1,message:(L==null?void 0:L.msg)||"å¯¼å…¥å¤±è´¥",errors:(L==null?void 0:L.errors)||[]},N.error(u.value.message))}catch(L){u.value={success:!1,message:L.message||"å¯¼å…¥å¤±è´¥",errors:[]},N.error(u.value.message)}finally{n.value=!1}}),I=()=>{n.value||(v.value=null,i.value=null,u.value=null,p("close"))};return(k,q)=>(d(),E(t(Ie),{modelValue:h.value,"onUpdate:modelValue":q[0]||(q[0]=J=>h.value=J),title:"å•å“å¯¼å…¥"},{"body-content":f(()=>[l("div",ka,[m(t(Te),{theme:"blue",title:"Excel æ ¼å¼è¦æ±‚",description:"ç¬¬ä¸€è¡Œï¼šäº§å“ç¼–ç  | äº§å“åç§° | æœˆä»½åˆ—ï¼›æœˆä»½æ ¼å¼æ”¯æŒ 2025-01ã€202501ã€2025/01ï¼›ç©ºå€¼æˆ– 0 å°†è¢«è·³è¿‡ã€‚"}),l("div",Ca,[m(t(M),{variant:"outline",theme:"blue","icon-left":"download",loading:c.value,onClick:x},{default:f(()=>[...q[1]||(q[1]=[P(" ä¸‹è½½å¯¼å…¥æ¨¡æ¿ ",-1)])]),_:1},8,["loading"])]),l("div",$a,[l("div",Sa,[q[3]||(q[3]=l("div",{class:"text-sm font-medium text-gray-800"},"é€‰æ‹© Excel æ–‡ä»¶",-1)),v.value?(d(),E(t(se),{key:0,theme:"green",size:"sm"},{default:f(()=>[...q[2]||(q[2]=[P("å·²ä¸Šä¼ ",-1)])]),_:1})):z("",!0)]),m(t(Ks),{"file-types":".xlsx,.xls","upload-args":{private:!0,folder:"Home"},onSuccess:_,onFailure:O},{default:f(({openFileSelector:J,uploading:L,progress:Z})=>[m(t(M),{variant:"solid",theme:"blue","icon-left":"upload",loading:L,onClick:()=>{i.value=null,J()}},{default:f(()=>[P(S(L?`ä¸Šä¼ ä¸­ ${Z}%`:"é€‰æ‹©æ–‡ä»¶"),1)]),_:2},1032,["loading","onClick"])]),_:1}),v.value?(d(),w("p",Oa," å·²é€‰æ‹©ï¼š"+S(v.value.file_name||v.value.name||"å·²ä¸Šä¼ æ–‡ä»¶"),1)):z("",!0),i.value?(d(),w("p",Ia,S(i.value),1)):z("",!0)]),u.value?(d(),w("div",Da,[m(t(Te),{theme:u.value.success?"green":"red",title:u.value.success?"å¯¼å…¥æˆåŠŸ":"å¯¼å…¥å¤±è´¥",description:u.value.message},null,8,["theme","title","description"]),u.value.errors&&u.value.errors.length?(d(),w("div",Pa,[q[4]||(q[4]=l("p",{class:"text-sm font-medium text-red-800 mb-1"},"é”™è¯¯è¯¦æƒ…ï¼š",-1)),l("ul",za,[(d(!0),w(ge,null,$e(u.value.errors,(J,L)=>(d(),w("li",{key:L}," â€¢ "+S(J),1))),128))])])):z("",!0)])):z("",!0)])]),actions:f(()=>[m(t(M),{variant:"subtle",theme:"gray",onClick:I},{default:f(()=>[...q[5]||(q[5]=[P(" å–æ¶ˆ ",-1)])]),_:1}),m(t(M),{variant:"solid",theme:"blue","icon-left":"play",loading:n.value,disabled:!v.value,onClick:g},{default:f(()=>[...q[6]||(q[6]=[P(" å¼€å§‹å¯¼å…¥ ",-1)])]),_:1},8,["loading","disabled"])]),_:1},8,["modelValue"]))}},Ba=ne(Ea,[["__scopeId","data-v-463b2196"]]),Aa={class:"product-add-dialog"},Fa={class:"search-filter-section"},Va={class:"section-header"},qa={class:"filter-grid"},Ta={class:"filter-item"},Ma={class:"filter-item"},La={class:"filter-item"},Na={class:"filter-summary"},Ra={class:"flex items-center gap-2 text-sm text-gray-600"},Ua={class:"text-gray-900"},ja={class:"product-list-section"},Ha={class:"section-header"},Ka={key:0,class:"loading-state"},Ja={key:1,class:"empty-state"},Qa={key:2,class:"product-list"},Xa={class:"select-all-item"},Wa={class:"text-gray-500 text-sm ml-2"},Ga={class:"product-items"},Ya=["onClick"],Za={class:"product-checkbox"},el={class:"product-info"},tl={class:"product-header"},sl={class:"product-code-name"},al={class:"product-code"},ll={class:"product-name"},ol={class:"product-details"},nl={key:0,class:"product-detail-item"},rl={key:1,class:"product-detail-item"},il={key:2,class:"product-detail-item"},ul={key:0,class:"pagination-section"},dl={class:"pagination-info"},cl={class:"pagination-controls"},fl={class:"pagination-pages"},pl={class:"current-page"},ml={class:"total-pages"},gl={class:"dialog-actions"},vl={key:0},hl={key:1},yl={__name:"ProductAddDialog",props:{show:{type:Boolean,default:!1},storeId:{type:String,required:!0},taskId:{type:String,required:!0},existingProducts:{type:Array,default:()=>[]}},emits:["close","success"],setup(s,{emit:a}){const e=s,p=a,n=B(!1),c=B(!1),v=B([]),i=B(new Set),u=B(""),h=B(""),x=B(""),_=B(""),O=B(1),g=B(20),I=B(null),k=C({get:()=>e.show,set:y=>{y||ye()}}),q=C(()=>{const y=new Set;return v.value.forEach(r=>{r.brand&&y.add(r.brand)}),Array.from(y).sort()}),J=C(()=>{const y=new Set;return v.value.forEach(r=>{r.category&&y.add(r.category)}),Array.from(y).sort()}),L=C(()=>[{label:"å…¨éƒ¨å“ç‰Œ",value:""},...q.value.map(y=>({label:y,value:y}))]),Z=C(()=>[{label:"å…¨éƒ¨åˆ†ç±»",value:""},...J.value.map(y=>({label:y,value:y}))]),G=C(()=>new Set(e.existingProducts.map(y=>y.code||y.commodity_code))),Y=y=>G.value.has(y.code),ee=C(()=>{let y=v.value;if(h.value){const r=h.value.toLowerCase();y=y.filter(o=>(o.code||"").toLowerCase().includes(r)||(o.name1||"").toLowerCase().includes(r))}return x.value&&(y=y.filter(r=>r.brand===x.value)),_.value&&(y=y.filter(r=>r.category===_.value)),y}),ve=C(()=>ee.value.length),le=C(()=>{const y=(O.value-1)*g.value,r=y+g.value;return ee.value.slice(y,r)}),de=C(()=>Math.ceil(ee.value.length/g.value)||1),Se=C(()=>(O.value-1)*g.value+1),Oe=C(()=>{const y=O.value*g.value;return y>ee.value.length?ee.value.length:y}),_e=C(()=>le.value.length>0&&le.value.every(y=>i.value.has(y.code)||Y(y))),he=()=>H(this,null,function*(){n.value=!0;try{const y=yield me("frappe.client.get_list",{doctype:"Product List",fields:["name as code","name1","specifications","brand","category"],limit_page_length:500,or_filters:u.value?[["code","like",`%${u.value}%`],["name1","like",`%${u.value}%`]]:[],order_by:"name1 asc"});v.value=Array.isArray(y)?y:[]}catch(y){N.error(y.message||"åŠ è½½äº§å“å¤±è´¥")}finally{n.value=!1}}),xe=y=>{const r=new Set(i.value);r.has(y)?r.delete(y):r.add(y),i.value=r},we=()=>{const y=new Set(i.value);_e.value?le.value.forEach(r=>{Y(r)||y.delete(r.code)}):le.value.forEach(r=>{Y(r)||y.add(r.code)}),i.value=y},ke=y=>{y<1||y>de.value||(O.value=y)},te=()=>H(this,null,function*(){if(i.value.size===0){N.warning("è¯·é€‰æ‹©è¦æ·»åŠ çš„å•†å“");return}c.value=!0;try{const y=Array.from(i.value),r=yield me("product_sales_planning.api.v1.commodity.bulk_insert_commodity_schedule",{store_id:e.storeId,task_id:e.taskId,codes:JSON.stringify(y)});if(r&&r.status==="success"){const o=r.skipped>0?`ï¼Œè·³è¿‡ ${r.skipped} ä¸ªå·²å­˜åœ¨çš„å•†å“`:"";N.success(`æˆåŠŸæ·»åŠ  ${r.count} ä¸ªå•†å“${o}`),p("success"),ye()}else N.error((r==null?void 0:r.msg)||(r==null?void 0:r.message)||"æ·»åŠ å¤±è´¥")}catch(y){N.error(y.message||"æ·»åŠ å¤±è´¥")}finally{c.value=!1}}),ye=()=>{c.value||(i.value=new Set,u.value="",x.value="",_.value="",O.value=1,p("close"))},ce=y=>{u.value=y};return ae(u,y=>{I.value&&clearTimeout(I.value),I.value=setTimeout(()=>{h.value=y,O.value=1},300)}),ae([x,_],()=>{O.value=1}),ae(h,()=>{O.value=1}),ae(()=>e.show,y=>{y&&he()}),Me(()=>{e.show&&he()}),(y,r)=>(d(),E(t(Ie),{modelValue:k.value,"onUpdate:modelValue":r[5]||(r[5]=o=>k.value=o),options:{title:"æ·»åŠ å•†å“",size:"4xl"}},{"body-content":f(()=>[l("div",Aa,[l("div",Fa,[l("div",Va,[m(t(T),{name:"search",class:"w-4 h-4 text-blue-600"}),r[6]||(r[6]=l("h3",{class:"section-title"},"æœç´¢å•†å“",-1))]),l("div",qa,[l("div",Ta,[r[7]||(r[7]=l("label",{class:"filter-label"},[l("span",null,"å•†å“æœç´¢"),l("span",{class:"text-gray-400 text-xs ml-1"},"(ç¼–ç /åç§°)")],-1)),m(t(ot),{modelValue:u.value,"onUpdate:modelValue":[r[0]||(r[0]=o=>u.value=o),ce],placeholder:"è¾“å…¥å•†å“ç¼–ç æˆ–åç§°"},{prefix:f(()=>[m(t(T),{name:"search",class:"w-4 h-4 text-gray-400"})]),_:1},8,["modelValue"])]),l("div",Ma,[r[8]||(r[8]=l("label",{class:"filter-label"},"å“ç‰Œç­›é€‰",-1)),m(t(ze),{modelValue:x.value,"onUpdate:modelValue":r[1]||(r[1]=o=>x.value=o),options:L.value,placeholder:"å…¨éƒ¨å“ç‰Œ"},null,8,["modelValue","options"])]),l("div",La,[r[9]||(r[9]=l("label",{class:"filter-label"},"åˆ†ç±»ç­›é€‰",-1)),m(t(ze),{modelValue:_.value,"onUpdate:modelValue":r[2]||(r[2]=o=>_.value=o),options:Z.value,placeholder:"å…¨éƒ¨åˆ†ç±»"},null,8,["modelValue","options"])])]),l("div",Na,[l("div",Ra,[m(t(T),{name:"package",class:"w-4 h-4"}),l("span",null,[r[10]||(r[10]=P("å€™é€‰å•†å“ï¼š",-1)),l("strong",Ua,S(ve.value),1),r[11]||(r[11]=P(" ä¸ª",-1))])]),i.value.size?(d(),E(t(se),{key:0,theme:"blue",size:"md"},{default:f(()=>[m(t(T),{name:"check-circle",class:"w-3 h-3 mr-1"}),P(" å·²é€‰ "+S(i.value.size)+" ä¸ª ",1)]),_:1})):z("",!0)])]),l("div",ja,[l("div",Ha,[m(t(T),{name:"list",class:"w-4 h-4 text-blue-600"}),r[12]||(r[12]=l("h3",{class:"section-title"},"å•†å“åˆ—è¡¨",-1))]),n.value?(d(),w("div",Ka,[m(t(la),{class:"w-6 h-6 text-blue-600"}),r[13]||(r[13]=l("span",{class:"loading-text"},"æ­£åœ¨åŠ è½½å•†å“æ•°æ®...",-1))])):le.value.length===0?(d(),w("div",Ja,[m(t(T),{name:"inbox",class:"w-12 h-12 text-gray-300"}),r[14]||(r[14]=l("div",{class:"empty-title"},"æ²¡æœ‰æ‰¾åˆ°å•†å“",-1)),r[15]||(r[15]=l("div",{class:"empty-description"},"è¯·å°è¯•è°ƒæ•´æœç´¢æ¡ä»¶æˆ–ç­›é€‰å™¨",-1))])):(d(),w("div",Qa,[l("div",Xa,[m(t(Ye),{"model-value":_e.value,onChange:we},null,8,["model-value"]),l("label",{class:"select-all-label",onClick:we},[r[16]||(r[16]=l("span",{class:"font-medium"},"å…¨é€‰å½“å‰é¡µ",-1)),l("span",Wa," (å·²é€‰æ‹© "+S(i.value.size)+" / "+S(ee.value.length)+" ä¸ª) ",1)])]),l("div",Ga,[(d(!0),w(ge,null,$e(le.value,o=>(d(),w("div",{key:o.code,class:K(["product-item",{"product-item-selected":i.value.has(o.code),"product-item-disabled":Y(o)}]),onClick:$=>!Y(o)&&xe(o.code)},[l("div",Za,[m(t(Ye),{"model-value":i.value.has(o.code),disabled:Y(o),onChange:Et($=>xe(o.code),["stop"])},null,8,["model-value","disabled","onChange"])]),l("div",el,[l("div",tl,[l("div",sl,[l("span",al,S(o.code),1),r[17]||(r[17]=l("span",{class:"product-separator"},"-",-1)),l("span",ll,S(o.name1),1)]),Y(o)?(d(),E(t(se),{key:0,theme:"gray",size:"xs"},{default:f(()=>[m(t(T),{name:"check",class:"w-3 h-3 mr-1"}),r[18]||(r[18]=P(" å·²å­˜åœ¨ ",-1))]),_:1})):z("",!0)]),l("div",ol,[o.specifications?(d(),w("div",nl,[m(t(T),{name:"box",class:"w-3 h-3"}),l("span",null,S(o.specifications),1)])):z("",!0),o.brand?(d(),w("div",rl,[m(t(T),{name:"tag",class:"w-3 h-3"}),l("span",null,S(o.brand),1)])):z("",!0),o.category?(d(),w("div",il,[m(t(T),{name:"folder",class:"w-3 h-3"}),l("span",null,S(o.category),1)])):z("",!0)])])],10,Ya))),128))])]))]),de.value>1?(d(),w("div",ul,[l("div",dl,[r[19]||(r[19]=P(" æ˜¾ç¤º ",-1)),l("strong",null,S(Se.value),1),r[20]||(r[20]=P(" - ",-1)),l("strong",null,S(Oe.value),1),r[21]||(r[21]=P(" æ¡ï¼Œ å…± ",-1)),l("strong",null,S(ee.value.length),1),r[22]||(r[22]=P(" æ¡ ",-1))]),l("div",cl,[m(t(M),{variant:"ghost",theme:"gray","icon-left":"chevron-left",size:"sm",disabled:O.value===1,onClick:r[3]||(r[3]=o=>ke(O.value-1))},{default:f(()=>[...r[23]||(r[23]=[P(" ä¸Šä¸€é¡µ ",-1)])]),_:1},8,["disabled"]),l("div",fl,[l("span",pl,S(O.value),1),r[24]||(r[24]=l("span",{class:"page-separator"},"/",-1)),l("span",ml,S(de.value),1)]),m(t(M),{variant:"ghost",theme:"gray","icon-right":"chevron-right",size:"sm",disabled:O.value===de.value,onClick:r[4]||(r[4]=o=>ke(O.value+1))},{default:f(()=>[...r[25]||(r[25]=[P(" ä¸‹ä¸€é¡µ ",-1)])]),_:1},8,["disabled"])])])):z("",!0)])]),actions:f(()=>[l("div",gl,[m(t(M),{variant:"subtle",theme:"gray","icon-left":"x",onClick:ye},{default:f(()=>[...r[26]||(r[26]=[P(" å–æ¶ˆ ",-1)])]),_:1}),m(t(M),{variant:"solid",theme:"blue","icon-left":"check",disabled:i.value.size===0||c.value,loading:c.value,onClick:te},{default:f(()=>[c.value?(d(),w("span",vl,"æ·»åŠ ä¸­...")):(d(),w("span",hl,"ç¡®è®¤æ·»åŠ  ("+S(i.value.size)+")",1))]),_:1},8,["disabled","loading"])])]),_:1},8,["modelValue"]))}},bl=ne(yl,[["__scopeId","data-v-f7378565"]]),_l={key:0,class:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},xl={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},wl={key:2,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},kl={class:"text-sm font-medium"},Cl={__name:"SaveIndicator",props:{isSaving:{type:Boolean,default:!1},saveError:{type:String,default:null},lastSaveTime:{type:Date,default:null}},setup(s){const a=s,e=B(!1),p=B(null),n=C(()=>a.isSaving?"bg-blue-50 text-blue-700 border border-blue-200":a.saveError?"bg-red-50 text-red-700 border border-red-200":"bg-green-50 text-green-700 border border-green-200"),c=C(()=>a.isSaving?"æ­£åœ¨ä¿å­˜...":a.saveError?`ä¿å­˜å¤±è´¥: ${a.saveError}`:a.lastSaveTime?"ä¿å­˜æˆåŠŸ":"");return ae(()=>a.isSaving,v=>{v&&(e.value=!0,p.value&&(clearTimeout(p.value),p.value=null))}),ae(()=>a.lastSaveTime,v=>{v&&!a.isSaving&&(e.value=!0,p.value&&clearTimeout(p.value),p.value=setTimeout(()=>{e.value=!1},2e3))}),ae(()=>a.saveError,v=>{v&&!a.isSaving&&(e.value=!0,p.value&&clearTimeout(p.value),p.value=setTimeout(()=>{e.value=!1},5e3))}),(v,i)=>(d(),E(Bt,{"enter-active-class":"transition-all duration-200 ease-out","enter-from-class":"opacity-0 translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-2"},{default:f(()=>[e.value?(d(),w("div",{key:0,class:K(["save-indicator fixed top-20 right-6 z-50 flex items-center gap-2 px-4 py-3 rounded-lg shadow-lg",n.value])},[s.isSaving?(d(),w("svg",_l,[...i[0]||(i[0]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):s.saveError?(d(),w("svg",wl,[...i[2]||(i[2]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,-1)])])):(d(),w("svg",xl,[...i[1]||(i[1]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])),l("span",kl,S(c.value),1)],2)):z("",!0)]),_:1}))}},$l=ne(Cl,[["__scopeId","data-v-4287462e"]]),Sl={class:"store-detail-page min-h-screen bg-gray-50 p-4 lg:p-6"},Ol={class:"max-w-[1920px] mx-auto space-y-4"},Il={class:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between"},Dl={class:"flex items-start gap-3"},Pl={class:"flex items-center gap-2 flex-wrap"},zl={class:"text-xl font-semibold text-gray-900"},El={class:"text-sm text-gray-500 flex items-center gap-2 mt-1"},Bl={class:"flex flex-wrap items-center gap-2"},Al={class:"hidden md:flex flex-wrap items-center gap-2"},Fl={class:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between"},Vl={class:"flex items-center gap-3"},ql={class:"flex items-center gap-2"},Tl={class:"text-sm text-gray-500"},Ml={class:"border-b border-gray-100 px-5 py-3 bg-gray-50"},Ll={class:"flex items-center justify-between"},Nl={class:"flex items-center gap-2 text-gray-900 font-medium"},Rl={class:"p-4"},Ul={class:"space-y-3"},jl={class:"text-sm text-gray-600"},Hl={class:"text-gray-900"},Kl={class:"p-3 bg-red-50 rounded-lg border border-red-100"},Jl={class:"flex items-start gap-2"},Ql={__name:"StoreDetail",props:{storeId:{type:String,required:!0},taskId:{type:String,required:!0}},setup(s){const a=s,e=At(),{filters:p,pagination:n,filteredCommodities:c,storeInfo:v,taskInfo:i,canEdit:u,statistics:h,totalPages:x,totalCount:_,loading:O,error:g,filterOptions:I,isSaving:k,saveError:q,lastSaveTime:J,selectedRows:L,selectedCount:Z,hasSelection:G,refreshData:Y,updateFilters:ee,updatePagination:ve,batchSaveChanges:le,exportToExcel:de,generateColumns:Se,generateHeaders:Oe,transformDataForTable:_e,updateSelectedRows:he,batchDeleteSelected:xe}=na(a.storeId,a.taskId),we=C(()=>{const A=Se();return[{data:"__selected",title:"",width:40,type:"checkbox",className:"htCenter htMiddle",readOnly:!1},...A]}),ke=C(()=>["",...Oe()]),te=C(()=>_e().map((b,V)=>j({__selected:L.value.includes(V)},b))),ye=C(()=>{var A;return g.value?typeof g.value=="string"?g.value:((A=g.value)==null?void 0:A.message)||"åŠ è½½å¤±è´¥":""}),ce=B(!1),y=B(!1),r=B(!1),o=B(!1),$=B(!1),U=B(null),D=B(new Set),{hotInstance:F,updateData:Q,clearSelection:oe}=Vt(U,{data:te,columns:we,colHeaders:ke,rowHeaders:!0,fixedColumnsLeft:4,contextMenu:!0,dropdownMenu:["filter_by_condition","filter_by_value","filter_action_bar"],filters:!0,columnSorting:!0,manualColumnResize:!0,manualRowResize:!0,copyPaste:{columnsLimit:1e3,rowsLimit:1e4,pasteMode:"overwrite"},fillHandle:{autoInsertRow:!1,direction:"vertical"},height:600,licenseKey:"non-commercial-and-evaluation",language:"zh-CN",stretchH:"none",autoWrapRow:!0,autoWrapCol:!0,className:"htCenter htMiddle",cells:(A,b)=>{const V={};return b===0?(V.readOnly=!1,V):(u.value||(V.readOnly=!0,V.className="htDimmed"),V)},afterChange:(A,b)=>{!A||b==="loadData"||nt(A)},afterSelection:(A,b,V,Fe)=>{},beforeCopy:(A,b)=>!0,beforePaste:(A,b)=>u.value?!0:(N.warning("å½“å‰çŠ¶æ€ä¸å¯ç¼–è¾‘"),!1)}),Ce=C(()=>Se().map((b,V)=>({label:b.title||b.data,value:b.data,icon:D.value.has(b.data)?"eye-off":"eye",onClick:()=>fe(b.data,V+1)}))),fe=(A,b)=>{if(!F.value)return;const V=F.value.getPlugin("hiddenColumns");D.value.has(A)?(D.value.delete(A),V.showColumn(b)):(D.value.add(A),V.hideColumn(b)),F.value.render()},pe=C(()=>[{label:"æ‰¹é‡åˆ é™¤",icon:"trash",disabled:!u.value||!G.value,onClick:()=>{if(!u.value){N.warning("å½“å‰å®¡æ‰¹çŠ¶æ€ä¸å¯ç¼–è¾‘");return}if(!G.value){N.info("è¯·é€‰æ‹©è¦åˆ é™¤çš„å•†å“");return}r.value=!0}},{label:"å•å“å¯¼å…¥",icon:"upload",disabled:!u.value,onClick:()=>ce.value=!0},{label:"æ·»åŠ å•†å“",icon:"plus",disabled:!u.value,onClick:()=>y.value=!0},{label:"å¯¼å‡ºExcel",icon:"download",disabled:o.value,onClick:()=>je()},{label:"åˆ·æ–°",icon:"refresh-cw",onClick:()=>Ae()}]),De=()=>{e.push({name:"PlanningDashboard"})},Ae=()=>H(this,null,function*(){yield Y(),F.value&&Q(te.value),N.info("æ•°æ®å·²åˆ·æ–°")}),nt=(A,b)=>H(this,null,function*(){if(!A||A.length===0)return;const V=new Set(L.value||[]);let Fe=!1;const Ve=[];if(A.forEach(([re,He,qe,Pe])=>{if(He==="__selected"){if(Pe===qe)return;Fe=!0,Pe?V.add(re):V.delete(re)}else qe!==Pe&&Ve.push([re,He,qe,Pe])}),Fe&&he(Array.from(V)),Ve.length>0&&u.value)try{const re=yield le(Ve);re.success?N.success("ä¿å­˜æˆåŠŸ"):(N.error(re.message||"ä¿å­˜å¤±è´¥"),F.value&&Q(te.value))}catch(re){console.error("ä¿å­˜å¤±è´¥:",re),N.error(re.message||"ä¿å­˜å¤±è´¥"),F.value&&Q(te.value)}}),Ue=()=>H(this,null,function*(){yield Y(),F.value&&Q(te.value),N.success("å¯¼å…¥æˆåŠŸï¼Œæ•°æ®å·²æ›´æ–°")}),je=()=>H(this,null,function*(){o.value=!0;try{const A=yield de();A.success?N.success(A.message||"å¯¼å‡ºæˆåŠŸ"):N.error(A.message||"å¯¼å‡ºå¤±è´¥")}catch(A){N.error(A.message||"å¯¼å‡ºå¤±è´¥")}finally{o.value=!1}}),rt=()=>H(this,null,function*(){if(Z.value===0){r.value=!1;return}$.value=!0;try{const A=yield xe();A.success?(N.success(A.message||"åˆ é™¤æˆåŠŸ"),r.value=!1,F.value&&Q(te.value)):N.error(A.message||"åˆ é™¤å¤±è´¥")}catch(A){N.error(A.message||"åˆ é™¤å¤±è´¥")}finally{$.value=!1}});return ae(te,A=>{F.value&&!k.value&&Q(A)},{deep:!1}),ae([p,n],()=>{F.value&&(oe(),he([]))},{deep:!0}),Me(()=>{}),Ft(()=>{F.value&&F.value.destroy()}),(A,b)=>(d(),w("div",Sl,[l("div",Ol,[m(t(be),{class:"p-4 lg:p-5"},{default:f(()=>[l("div",Il,[l("div",Dl,[m(t(M),{variant:"ghost",theme:"gray",size:"sm",onClick:De},{prefix:f(()=>[m(t(T),{name:"arrow-left",class:"h-4 w-4"})]),default:f(()=>[b[9]||(b[9]=P(" è¿”å›žçœ‹æ¿ ",-1))]),_:1}),l("div",null,[l("div",Pl,[l("h1",zl,S(t(v).shop_name||t(v).name||"åº—é“ºè¯¦æƒ…"),1),t(i).task_type?(d(),E(t(se),{key:0,theme:"blue",size:"sm"},{default:f(()=>[P(S(t(i).task_type),1)]),_:1})):z("",!0)]),l("div",El,[m(t(T),{name:"calendar",class:"w-4 h-4"}),l("span",null,S(t(i).task_name||t(i).name||"ä»»åŠ¡ä¿¡æ¯åŠ è½½ä¸­"),1)])])]),l("div",Bl,[l("div",Al,[t(u)?(d(),E(t(M),{key:0,variant:"outline",theme:"blue",onClick:b[0]||(b[0]=V=>ce.value=!0)},{prefix:f(()=>[m(t(T),{name:"upload",class:"h-4 w-4"})]),default:f(()=>[b[10]||(b[10]=P(" å•å“å¯¼å…¥ ",-1))]),_:1})):z("",!0),t(u)?(d(),E(t(M),{key:1,variant:"outline",theme:"purple",onClick:b[1]||(b[1]=V=>y.value=!0)},{prefix:f(()=>[m(t(T),{name:"plus",class:"h-4 w-4"})]),default:f(()=>[b[11]||(b[11]=P(" æ·»åŠ å•†å“ ",-1))]),_:1})):z("",!0),m(t(M),{variant:"outline",theme:"green",loading:o.value,onClick:je},{prefix:f(()=>[m(t(T),{name:"download",class:"h-4 w-4"})]),default:f(()=>[b[12]||(b[12]=P(" å¯¼å‡ºExcel ",-1))]),_:1},8,["loading"]),m(t(M),{variant:"ghost",theme:"gray",onClick:Ae},{prefix:f(()=>[m(t(T),{name:"refresh-cw",class:"h-4 w-4"})]),default:f(()=>[b[13]||(b[13]=P(" åˆ·æ–° ",-1))]),_:1})]),m(t(Ge),{class:"md:hidden",options:pe.value,placement:"bottom-end"},{default:f(({open:V})=>[m(t(M),{variant:"outline",theme:"gray"},{prefix:f(()=>[m(t(T),{name:"more-horizontal",class:"h-4 w-4"})]),default:f(()=>[P(" "+S(V?"æ”¶èµ·":"æ“ä½œ"),1)]),_:2},1024)]),_:1},8,["options"])])])]),_:1}),t(g)?(d(),E(t(Te),{key:0,theme:"red",title:"åŠ è½½å¤±è´¥"},{default:f(()=>[P(S(ye.value),1)]),_:1})):z("",!0),t(O)?(d(),E(t(be),{key:1,class:"p-6 flex items-center justify-center"},{default:f(()=>[...b[14]||(b[14]=[l("div",{class:"flex items-center gap-3 text-gray-600"},[l("div",{class:"h-5 w-5 animate-spin rounded-full border-2 border-gray-200 border-t-blue-600"}),l("span",null,"æ­£åœ¨åŠ è½½æ•°æ®...")],-1)])]),_:1})):(d(),w(ge,{key:2},[m(va,{statistics:t(h)},null,8,["statistics"]),m(fa,{filters:t(p),"filter-options":t(I),loading:t(O),"onUpdate:filters":t(ee)},null,8,["filters","filter-options","loading","onUpdate:filters"]),m(t(be),{class:"p-4"},{default:f(()=>[l("div",Fl,[l("div",Vl,[t(u)&&t(G)?(d(),E(t(M),{key:0,variant:"solid",theme:"red",size:"sm",onClick:b[2]||(b[2]=V=>r.value=!0)},{prefix:f(()=>[m(t(T),{name:"trash-2",class:"h-4 w-4"})]),default:f(()=>[P(" åˆ é™¤é€‰ä¸­ ("+S(t(Z))+") ",1)]),_:1})):z("",!0),t(G)?(d(),E(t(se),{key:1,theme:"blue",variant:"subtle"},{default:f(()=>[P(" å·²é€‰æ‹© "+S(t(Z))+" é¡¹ ",1)]),_:1})):z("",!0)]),l("div",ql,[m(t(Ge),{options:Ce.value,placement:"bottom-end"},{default:f(({open:V})=>[m(t(M),{variant:"outline",theme:"gray",size:"sm"},{prefix:f(()=>[m(t(T),{name:"columns",class:"h-4 w-4"})]),suffix:f(()=>[m(t(T),{name:V?"chevron-up":"chevron-down",class:"h-4 w-4"},null,8,["name"])]),default:f(()=>[b[15]||(b[15]=P(" åˆ—æ˜¾ç¤ºè®¾ç½® ",-1))]),_:2},1024)]),_:1},8,["options"]),l("div",Tl," å…± "+S(t(_))+" æ¡æ•°æ® ",1)])])]),_:1}),m(t(be),{class:"overflow-hidden"},{default:f(()=>[l("div",Ml,[l("div",Ll,[l("div",Nl,[m(t(T),{name:"table",class:"h-4 w-4 text-gray-500"}),b[16]||(b[16]=l("span",null,"å•†å“è®¡åˆ’æ•°æ®",-1))]),t(k)?(d(),E(t(se),{key:0,theme:"blue",variant:"subtle"},{prefix:f(()=>[...b[17]||(b[17]=[l("div",{class:"h-3 w-3 animate-spin rounded-full border-2 border-blue-100 border-t-blue-600"},null,-1)])]),default:f(()=>[b[18]||(b[18]=P(" ä¿å­˜ä¸­... ",-1))]),_:1})):t(q)?(d(),E(t(se),{key:1,theme:"red",variant:"subtle"},{prefix:f(()=>[m(t(T),{name:"alert-circle",class:"h-3 w-3"})]),default:f(()=>[b[19]||(b[19]=P(" ä¿å­˜å¤±è´¥ ",-1))]),_:1})):t(J)?(d(),E(t(se),{key:2,theme:"green",variant:"subtle"},{prefix:f(()=>[m(t(T),{name:"check",class:"h-3 w-3"})]),default:f(()=>[P(" "+S(t(J)),1)]),_:1})):z("",!0)])]),l("div",Rl,[l("div",{ref_key:"tableContainer",ref:U,class:"handsontable-container",style:{height:"600px",overflow:"hidden"}},null,512)])]),_:1}),m(wa,{"current-page":t(n).currentPage,"page-size":t(n).pageSize,"total-items":t(_),"total-pages":t(x),"page-size-options":t(n).pageSizeOptions,"onUpdate:currentPage":b[3]||(b[3]=V=>t(ve)({currentPage:V})),"onUpdate:pageSize":b[4]||(b[4]=V=>t(ve)({pageSize:V}))},null,8,["current-page","page-size","total-items","total-pages","page-size-options"])],64)),m(Ba,{show:ce.value,"store-id":s.storeId,"task-id":s.taskId,onClose:b[5]||(b[5]=V=>ce.value=!1),onSuccess:Ue},null,8,["show","store-id","task-id"]),m(bl,{show:y.value,"store-id":s.storeId,"task-id":s.taskId,"existing-products":t(c),onClose:b[6]||(b[6]=V=>y.value=!1),onSuccess:Ue},null,8,["show","store-id","task-id","existing-products"]),m(t(Ie),{modelValue:r.value,"onUpdate:modelValue":b[8]||(b[8]=V=>r.value=V),title:"ç¡®è®¤æ‰¹é‡åˆ é™¤"},{"body-content":f(()=>[l("div",Ul,[l("p",jl,[b[20]||(b[20]=P(" ç¡®å®šåˆ é™¤é€‰ä¸­çš„ ",-1)),l("strong",Hl,S(t(Z)),1),b[21]||(b[21]=P(" ä¸ªå•†å“çš„æ‰€æœ‰è®¡åˆ’è®°å½•å—ï¼Ÿ ",-1))]),l("div",Kl,[l("div",Jl,[m(t(T),{name:"alert-triangle",class:"h-4 w-4 text-red-600 mt-0.5"}),b[22]||(b[22]=l("p",{class:"text-sm text-red-800"}," è¯¥æ“ä½œä¸å¯æ’¤é”€ï¼Œè¯·è°¨æ…Žæ“ä½œï¼ ",-1))])])])]),actions:f(()=>[m(t(M),{variant:"subtle",theme:"gray",onClick:b[7]||(b[7]=V=>r.value=!1)},{default:f(()=>[...b[23]||(b[23]=[P(" å–æ¶ˆ ",-1)])]),_:1}),m(t(M),{variant:"solid",theme:"red",loading:$.value,onClick:rt},{default:f(()=>[...b[24]||(b[24]=[P(" ç¡®è®¤åˆ é™¤ ",-1)])]),_:1},8,["loading"])]),_:1},8,["modelValue"]),m($l,{"is-saving":t(k),"save-error":t(q),"last-save-time":t(J)},null,8,["is-saving","save-error","last-save-time"])])]))}},Yl=ne(Ql,[["__scopeId","data-v-4580f373"]]);export{Yl as default};
