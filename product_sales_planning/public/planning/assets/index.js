var S=(b,c,a)=>new Promise((r,o)=>{var n=g=>{try{f(a.next(g))}catch(x){o(x)}},l=g=>{try{f(a.throw(g))}catch(x){o(x)}},f=g=>g.done?r(g.value):Promise.resolve(g.value).then(n,l);f((a=a.apply(b,c)).next())});import{u as q,r as z,a as H,c as B,b as $,w as U,o as D,d as _,e as h,f as s,g as d,h as v,i as t,B as w,j as V,A as E,k,l as G,v as W,I as K,_ as C,t as p,F as P,m as R,n as I,p as m,q as y,L as M,s as J,x as Q,y as X,z as Y,C as Z,D as ee,E as te,G as se}from"./vendor.js";const oe=function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function a(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerpolicy&&(n.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?n.credentials="include":o.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=a(o);fetch(o.href,n)}};oe();const ae="modulepreload",N={},ne="/assets/product_sales_planning/planning/",re=function(c,a){return!a||a.length===0?c():Promise.all(a.map(r=>{if(r=`${ne}${r}`,r in N)return;N[r]=!0;const o=r.endsWith(".css"),n=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${n}`))return;const l=document.createElement("link");if(l.rel=o?"stylesheet":ae,o||(l.as="script",l.crossOrigin=""),l.href=r,document.head.appendChild(l),o)return new Promise((f,g)=>{l.addEventListener("load",f),l.addEventListener("error",g)})})).then(()=>c())},le={class:"p-6 max-w-7xl mx-auto space-y-6"},ie={class:"flex justify-between items-center"},de=s("div",null,[s("h1",{class:"text-2xl font-bold text-gray-900"},"\u8BA1\u5212\u4EFB\u52A1\u770B\u677F"),s("p",{class:"text-sm text-gray-500 mt-1"},"\u5B9E\u65F6\u76D1\u63A7\u4EFB\u52A1\u6267\u884C\u4E0E\u5BA1\u6279\u72B6\u6001")],-1),ce={class:"flex gap-2"},ue=m(" \u6570\u636E\u67E5\u770B "),_e=m(" \u5237\u65B0 "),pe={class:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm"},me={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},ge=s("label",{class:"block text-xs text-gray-600 mb-1"},"\u5BA1\u6279\u72B6\u6001",-1),he={class:"flex items-end gap-2"},fe=m("\u67E5\u8BE2"),ve={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ye={class:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm flex items-center"},be={class:"w-12 h-12 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center mr-4"},xe={class:"text-2xl font-bold text-gray-900"},we=s("div",{class:"text-sm text-gray-500"},"\u8FDB\u884C\u4E2D\u8BA1\u5212",-1),ke={class:"bg-white p-6 rounded-lg border border-gray-200 shadow-sm flex items-center"},Ce={class:"w-12 h-12 rounded-lg bg-green-50 text-green-600 flex items-center justify-center mr-4"},Ve={class:"text-2xl font-bold text-gray-900"},Le=s("div",{class:"text-sm text-gray-500"},"\u5F85\u5904\u7406\u5E97\u94FA",-1),$e={class:"space-y-4"},je={class:"border-b border-gray-200"},Se={class:"-mb-px flex space-x-8","aria-label":"Tabs"},Be=["onClick"],De={class:"flex justify-between items-center text-sm text-gray-600"},Ee=s("span",null,"\u6267\u884C\u660E\u7EC6\u5217\u8868",-1),Pe={key:0,class:"flex justify-center py-12"},Re={key:1,class:"text-center py-12 bg-white rounded-lg border border-dashed border-gray-300"},Ie=s("p",{class:"text-gray-500"},"\u6682\u65E0\u5F00\u542F\u4E2D\u7684\u63D0\u62A5\u4EFB\u52A1",-1),Ne={key:2,class:"space-y-3"},Ae=["onClick"],Fe={class:"flex items-center gap-4 overflow-hidden"},Oe={class:"w-12 h-12 rounded-lg bg-gray-50 border border-gray-200 flex items-center justify-center text-lg font-bold text-gray-600 shrink-0"},Te={class:"min-w-0"},qe={class:"flex items-center gap-2 mb-1"},ze={class:"text-base font-bold text-gray-900 truncate"},He=m("\u6025"),Ue={class:"flex items-center text-xs text-gray-500 gap-3"},Ge={class:"flex items-center gap-1"},We=s("span",{class:"text-gray-300"},"\u2022",-1),Ke={class:"flex flex-col items-end gap-2 shrink-0 ml-4"},Me={class:"flex gap-2"},Je={setup(b){const c=q(),a=z({store_ids:[],task_ids:[],approval_status:""}),r=H("pending"),o=B({url:"product_sales_planning.planning_system.page.planning_dashboard.planning_dashboard.get_filter_options",auto:!0}),n=B({url:"product_sales_planning.planning_system.page.planning_dashboard.planning_dashboard.get_dashboard_data",auto:!1,makeParams(){var i,u;return{filters:{store_ids:((i=a.store_ids)==null?void 0:i.map(e=>e.value))||[],task_ids:((u=a.task_ids)==null?void 0:u.map(e=>e.value))||[],approval_status:a.approval_status,tab:r.value}}}}),l=$(()=>{var i;return((i=n.data)==null?void 0:i.stats)||{}}),f=$(()=>{var i;return((i=n.data)==null?void 0:i.tasks)||[]}),g=$(()=>[{id:"pending",name:"\u5F85\u5B8C\u6210",count:l.value.pending_count||0},{id:"completed",name:"\u5DF2\u5B8C\u6210",count:l.value.completed_count||0}]);function x(){n.reload()}function A(){a.store_ids=[],a.task_ids=[],a.approval_status="",n.reload()}function F(){window.location.href="/app/data-view"}function O(i){c.push({name:"StoreDetail",params:{storeId:i.store_id,parentId:i.parent_id}})}function j(i,u){if(!i||i==="\u672A\u5F00\u59CB")return"gray";const e=i.toString();if(u==="sub"){if(e.includes("\u5DF2\u63D0\u4EA4"))return"blue";if(e.includes("\u8349\u7A3F"))return"orange"}if(u==="app"){if(e.includes("\u901A\u8FC7"))return"green";if(e.includes("\u9A73\u56DE"))return"red";if(e.includes("\u5BA1\u6838")||e.includes("\u5F85"))return"yellow"}return"gray"}return U(r,()=>{r.value==="completed"&&(a.approval_status=""),n.reload()}),D(()=>{n.reload()}),(i,u)=>(_(),h("div",le,[s("div",ie,[de,s("div",ce,[d(t(w),{"icon-left":"table",variant:"outline",onClick:F},{default:v(()=>[ue]),_:1}),d(t(w),{"icon-left":"refresh-cw",variant:"solid",loading:t(n).loading,onClick:u[0]||(u[0]=e=>t(n).reload())},{default:v(()=>[_e]),_:1},8,["loading"])])]),s("div",pe,[s("div",me,[t(o).data?(_(),V(t(E),{key:0,label:"\u5E97\u94FA\u7B5B\u9009",placeholder:"\u9009\u62E9\u5E97\u94FA...",options:t(o).data.stores.map(e=>({label:e.shop_name,value:e.name})),modelValue:t(a).store_ids,"onUpdate:modelValue":u[1]||(u[1]=e=>t(a).store_ids=e),multiple:""},null,8,["options","modelValue"])):k("",!0),t(o).data?(_(),V(t(E),{key:1,label:"\u8BA1\u5212\u4EFB\u52A1",placeholder:"\u9009\u62E9\u4EFB\u52A1...",options:t(o).data.tasks.map(e=>({label:`${e.name} (${e.start_date||""})`,value:e.name})),modelValue:t(a).task_ids,"onUpdate:modelValue":u[2]||(u[2]=e=>t(a).task_ids=e),multiple:""},null,8,["options","modelValue"])):k("",!0),G(s("div",null,[ge,d(t(K),{type:"select",options:["","\u5F85\u5BA1\u6279","\u5DF2\u901A\u8FC7","\u5DF2\u9A73\u56DE"].map(e=>({label:e||"\u5168\u90E8",value:e})),modelValue:t(a).approval_status,"onUpdate:modelValue":u[3]||(u[3]=e=>t(a).approval_status=e)},null,8,["options","modelValue"])],512),[[W,r.value==="pending"]]),s("div",he,[d(t(w),{class:"w-full",variant:"subtle",onClick:x},{default:v(()=>[fe]),_:1}),d(t(w),{icon:"x",onClick:A})])])]),t(l)?(_(),h("div",ve,[s("div",ye,[s("div",be,[d(t(C),{name:"folder",class:"w-6 h-6"})]),s("div",null,[s("div",xe,p(t(l).ongoing||0),1),we])]),s("div",ke,[s("div",Ce,[d(t(C),{name:"check-square",class:"w-6 h-6"})]),s("div",null,[s("div",Ve,p(t(l).tasks_count||0),1),Le])])])):k("",!0),s("div",$e,[s("div",je,[s("nav",Se,[(_(!0),h(P,null,R(t(g),e=>(_(),h("button",{key:e.id,onClick:T=>r.value=e.id,class:I([r.value===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2"])},[m(p(e.name)+" ",1),d(t(y),{variant:"subtle",theme:"gray"},{default:v(()=>[m(p(e.count),1)]),_:2},1024)],10,Be))),128))])]),s("div",De,[Ee,d(t(y),{theme:"gray"},{default:v(()=>[m(p(t(f).length),1)]),_:1})]),t(n).loading?(_(),h("div",Pe,[d(t(M))])):t(f).length===0?(_(),h("div",Re,[d(t(C),{name:"box",class:"w-12 h-12 text-gray-300 mx-auto mb-3"}),Ie])):(_(),h("div",Ne,[(_(!0),h(P,null,R(t(f),e=>(_(),h("div",{key:e.row_id,onClick:T=>O(e),class:"bg-white border border-gray-200 rounded-lg p-4 hover:shadow-md hover:border-gray-300 transition-all cursor-pointer flex justify-between items-center group"},[s("div",Fe,[s("div",Oe,p(e.title.charAt(0)),1),s("div",Te,[s("div",qe,[s("h3",ze,p(e.title),1),d(t(y),{theme:"gray",size:"sm"},{default:v(()=>[m(p(e.channel),1)]),_:2},1024),e.is_urgent?(_(),V(t(y),{key:0,theme:"red",size:"sm",variant:"subtle"},{default:v(()=>[He]),_:1})):k("",!0)]),s("div",Ue,[s("span",Ge,[d(t(C),{name:"user",class:"w-3 h-3"}),m(" "+p(e.user),1)]),We,s("span",null,p(e.plan_type),1)])])]),s("div",Ke,[s("div",{class:I(["flex items-center text-xs",e.is_urgent?"text-red-500 font-bold":"text-gray-500"])},[d(t(C),{name:"calendar",class:"w-3 h-3 mr-1"}),m(" \u622A\u6B62 "+p(e.deadline),1)],2),s("div",Me,[d(t(y),{theme:j(e.child_status,"sub")},{default:v(()=>[m(p(e.child_status),1)]),_:2},1032,["theme"]),e.approval_status?(_(),V(t(y),{key:0,theme:j(e.approval_status,"app")},{default:v(()=>[m(p(e.approval_status),1)]),_:2},1032,["theme"])):k("",!0)])])],8,Ae))),128))]))])]))}},Qe=[{path:"/",name:"Home",component:()=>re(()=>import("./Home.js"),["assets/Home.js","assets/vendor.js","assets/vendor.css"])},{path:"/",name:"Dashboard",component:Je}];let Xe=J({history:Q("/planning/"),routes:Qe});const Ye={setup(b){return D(()=>S(this,null,function*(){try{const c=yield X("frappe.auth.get_logged_user");(!c||c==="Guest")&&(window.location.href="/login?redirect-to=/planning")}catch(c){window.location.href="/login?redirect-to=/planning"}})),(c,a)=>{const r=Y("router-view");return _(),h("div",null,[d(r)])}}};let L=Z(Ye);ee("resourceFetcher",se);L.use(Xe);L.use(te);L.component("Button",w);L.mount("#app");
