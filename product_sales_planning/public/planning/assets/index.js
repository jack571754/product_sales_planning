var V=(y,o,d)=>new Promise((h,i)=>{var a=m=>{try{x(d.next(m))}catch(v){i(v)}},u=m=>{try{x(d.throw(m))}catch(v){i(v)}},x=m=>m.done?h(m.value):Promise.resolve(m.value).then(a,u);x((d=d.apply(y,o)).next())});import{r as U,a as q,c as z,b as w,o as B,d as _,e as p,f as e,g as l,w as f,u as s,B as b,A,h as O,v as P,_ as k,t as c,i as L,F as $,j as N,n as M,k as g,L as E,l as C,m as G,p as H,q as K,s as W,x as J,y as Q,z as X,C as Y,D as Z}from"./vendor.js";const ee=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))h(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&h(u)}).observe(document,{childList:!0,subtree:!0});function d(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function h(i){if(i.ep)return;i.ep=!0;const a=d(i);fetch(i.href,a)}};ee();const te={class:"p-5 max-w-[1400px] mx-auto bg-gray-50 min-h-screen font-sans"},se={class:"flex justify-between items-center mb-5"},oe=e("div",null,[e("h1",{class:"text-xl font-bold text-gray-900"},"\u8BA1\u5212\u4EFB\u52A1\u770B\u677F"),e("p",{class:"text-xs text-gray-500 mt-1"},"\u5B9E\u65F6\u76D1\u63A7\u4EFB\u52A1\u6267\u884C\u4E0E\u5BA1\u6279\u72B6\u6001")],-1),ne={class:"flex gap-2"},ae=g(" \u6570\u636E\u67E5\u770B "),re=g(" \u5237\u65B0 "),ie={class:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm mb-5"},le={class:"grid grid-cols-1 md:grid-cols-12 gap-4 items-end"},de={class:"md:col-span-4 space-y-1"},ce=e("label",{class:"text-xs font-medium text-gray-500"},"\u5E97\u94FA\u7B5B\u9009",-1),ue={class:"md:col-span-4 space-y-1"},_e=e("label",{class:"text-xs font-medium text-gray-500"},"\u8BA1\u5212\u4EFB\u52A1",-1),pe={class:"md:col-span-2 space-y-1"},me=e("label",{class:"text-xs font-medium text-gray-500"},"\u5BA1\u6279\u72B6\u6001",-1),ge=["disabled"],he=e("option",{value:""},"\u5168\u90E8\u72B6\u6001",-1),fe=e("option",{value:"\u5F85\u5BA1\u6279"},"\u5F85\u5BA1\u6279",-1),xe=e("option",{value:"\u5DF2\u901A\u8FC7"},"\u5DF2\u901A\u8FC7",-1),ve=e("option",{value:"\u5DF2\u9A73\u56DE"},"\u5DF2\u9A73\u56DE",-1),be=[he,fe,xe,ve],ye={class:"md:col-span-2 flex gap-2"},we=g(" \u67E5\u8BE2 "),ke={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-5 mb-6"},Ce={class:"bg-white p-5 rounded-lg border border-gray-200 shadow-sm flex items-center"},je={class:"w-12 h-12 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center mr-4 shrink-0"},Ve={class:"text-2xl font-bold text-gray-900"},ze=e("div",{class:"text-xs text-gray-500 mt-1"},"\u8FDB\u884C\u4E2D\u8BA1\u5212",-1),Be={class:"bg-white p-5 rounded-lg border border-gray-200 shadow-sm flex items-center"},Ae={class:"w-12 h-12 rounded-lg bg-green-50 text-green-600 flex items-center justify-center mr-4 shrink-0"},Le={class:"text-2xl font-bold text-gray-900"},$e=e("div",{class:"text-xs text-gray-500 mt-1"},"\u5F85\u5904\u7406\u5E97\u94FA",-1),Ne={class:"bg-white border border-gray-200 rounded-lg shadow-sm"},Re={class:"border-b border-gray-200 px-5"},De={class:"flex space-x-6","aria-label":"Tabs"},Fe=["onClick"],Ie={class:"bg-gray-100 text-gray-600 px-2 py-0.5 rounded text-xs"},Te={class:"p-0 min-h-[300px]"},Se={key:0,class:"flex flex-col items-center justify-center py-16 text-gray-400"},Ue=e("span",{class:"text-sm"},"\u52A0\u8F7D\u4E2D...",-1),qe={key:1,class:"flex flex-col items-center justify-center py-16 text-gray-400"},Oe=e("p",{class:"text-sm"},"\u6682\u65E0\u6570\u636E",-1),Pe={key:2,class:"divide-y divide-gray-100"},Me=["onClick"],Ee={class:"flex items-center gap-4"},Ge={class:"w-10 h-10 rounded bg-gray-100 flex items-center justify-center text-lg font-bold text-gray-500 shrink-0 group-hover:bg-white group-hover:text-blue-600 border border-transparent group-hover:border-blue-100 transition-all"},He={class:"flex items-center gap-2 mb-1"},Ke={class:"text-sm font-bold text-gray-900"},We=g("\u6025"),Je={class:"flex items-center text-xs text-gray-400 gap-3"},Qe={class:"flex items-center gap-1"},Xe=e("span",null,"\u2022",-1),Ye={class:"text-right"},Ze={class:"text-xs text-gray-400 mb-1"},et={class:"flex justify-end gap-2"},tt={setup(y){const o=U({store_ids:[],task_ids:[],approval_status:""}),d=q("pending"),h=z({url:"product_sales_planning.planning_system.page.planning_dashboard.planning_dashboard.get_filter_options",auto:!0}),i=w(()=>{const n=h.data||{stores:[],tasks:[]};return{stores:n.stores.map(r=>({label:r.shop_name,value:r.name})),tasks:n.tasks.map(r=>({label:`${r.name} (${r.start_date||"\u65E0\u65E5\u671F"})`,value:r.name}))}}),a=z({url:"product_sales_planning.planning_system.page.planning_dashboard.planning_dashboard.get_dashboard_data",auto:!1,makeParams(){const n=Array.isArray(o.store_ids)?o.store_ids.map(t=>typeof t=="object"?t.value:t).filter(Boolean):[],r=Array.isArray(o.task_ids)?o.task_ids.map(t=>typeof t=="object"?t.value:t).filter(Boolean):[];return{filters:{store_ids:n,task_ids:r,approval_status:o.approval_status,tab:d.value}}}}),u=w(()=>{var n;return((n=a.data)==null?void 0:n.stats)||{}}),x=w(()=>{var n;return((n=a.data)==null?void 0:n.tasks)||[]}),m=w(()=>[{id:"pending",name:"\u5F85\u5B8C\u6210",count:u.value.pending_count||0},{id:"completed",name:"\u5DF2\u5B8C\u6210",count:u.value.completed_count||0}]);function v(n,r){if(!n||n==="\u672A\u5F00\u59CB")return"gray";if(r==="sub")return n.includes("\u5DF2\u63D0\u4EA4")?"blue":"orange";if(r==="app"){if(n.includes("\u901A\u8FC7"))return"green";if(n.includes("\u9A73\u56DE"))return"red";if(n.includes("\u5F85"))return"orange"}return"gray"}function R(){a.reload()}function D(){o.store_ids=[],o.task_ids=[],o.approval_status="",a.reload()}function F(n){d.value=n,n==="completed"&&(o.approval_status=""),a.reload()}function I(){window.location.href="/app/data-view"}function T(n){const r=`/app/store-detail?store_id=${encodeURIComponent(n.store_id)}&task_id=${encodeURIComponent(n.parent_id)}`;window.location.href=r}return B(()=>{a.reload()}),(n,r)=>(_(),p("div",te,[e("div",se,[oe,e("div",ne,[l(s(b),{"icon-left":"table",variant:"outline",size:"sm",onClick:I},{default:f(()=>[ae]),_:1}),l(s(b),{"icon-left":"refresh-cw",variant:"outline",size:"sm",loading:s(a).loading,onClick:r[0]||(r[0]=t=>s(a).reload())},{default:f(()=>[re]),_:1},8,["loading"])])]),e("div",ie,[e("div",le,[e("div",de,[ce,l(s(A),{placeholder:"\u9009\u62E9\u5E97\u94FA (\u53EF\u591A\u9009)...",options:s(i).stores,modelValue:s(o).store_ids,"onUpdate:modelValue":r[1]||(r[1]=t=>s(o).store_ids=t),multiple:"",size:"sm"},null,8,["options","modelValue"])]),e("div",ue,[_e,l(s(A),{placeholder:"\u9009\u62E9\u4EFB\u52A1 (\u53EF\u591A\u9009)...",options:s(i).tasks,modelValue:s(o).task_ids,"onUpdate:modelValue":r[2]||(r[2]=t=>s(o).task_ids=t),multiple:"",size:"sm"},null,8,["options","modelValue"])]),e("div",pe,[me,O(e("select",{"onUpdate:modelValue":r[3]||(r[3]=t=>s(o).approval_status=t),class:"form-select block w-full text-sm border-gray-200 rounded-md focus:border-blue-500 focus:ring-blue-500 h-[34px]",disabled:d.value==="completed"},be,8,ge),[[P,s(o).approval_status]])]),e("div",ye,[l(s(b),{variant:"solid",class:"w-full justify-center",size:"sm",onClick:R},{default:f(()=>[we]),_:1}),l(s(b),{icon:"x",variant:"ghost",size:"sm",onClick:D,title:"\u6E05\u7A7A\u7B5B\u9009"})])])]),s(u)?(_(),p("div",ke,[e("div",Ce,[e("div",je,[l(s(k),{name:"folder",class:"w-6 h-6"})]),e("div",null,[e("div",Ve,c(s(u).ongoing||0),1),ze])]),e("div",Be,[e("div",Ae,[l(s(k),{name:"check-square",class:"w-6 h-6"})]),e("div",null,[e("div",Le,c(s(u).tasks_count||0),1),$e])])])):L("",!0),e("div",Ne,[e("div",Re,[e("nav",De,[(_(!0),p($,null,N(s(m),t=>(_(),p("button",{key:t.id,onClick:S=>F(t.id),class:M(["py-3 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors",d.value===t.id?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"])},[g(c(t.name)+" ",1),e("span",Ie,c(t.count),1)],10,Fe))),128))])]),e("div",Te,[s(a).loading?(_(),p("div",Se,[l(s(E),{class:"mb-2"}),Ue])):s(x).length===0?(_(),p("div",qe,[l(s(k),{name:"inbox",class:"w-8 h-8 text-gray-300 mb-2"}),Oe])):(_(),p("div",Pe,[(_(!0),p($,null,N(s(x),t=>(_(),p("div",{key:t.row_id,onClick:S=>T(t),class:"p-4 hover:bg-gray-50 cursor-pointer group flex items-center justify-between transition-colors"},[e("div",Ee,[e("div",Ge,c(t.title.charAt(0)),1),e("div",null,[e("div",He,[e("h3",Ke,c(t.title),1),l(s(C),{theme:"gray",size:"sm"},{default:f(()=>[g(c(t.channel),1)]),_:2},1024),t.is_urgent?(_(),G(s(C),{key:0,theme:"red",size:"sm"},{default:f(()=>[We]),_:1})):L("",!0)]),e("div",Je,[e("span",Qe,[l(s(k),{name:"user",class:"w-3 h-3"}),g(" "+c(t.user),1)]),Xe,e("span",null,c(t.plan_type),1)])])]),e("div",Ye,[e("div",Ze,"\u622A\u6B62 "+c(t.deadline),1),e("div",et,[l(s(C),{theme:v(t.child_status,"sub")},{default:f(()=>[g(c(t.child_status),1)]),_:2},1032,["theme"]),l(s(C),{theme:v(t.approval_status,"app")},{default:f(()=>[g(c(t.approval_status),1)]),_:2},1032,["theme"])])])],8,Me))),128))]))])])]))}},st=[{path:"/",name:"Dashboard",component:tt}];let ot=H({history:K("/planning/"),routes:st});const nt={setup(y){return B(()=>V(this,null,function*(){try{const o=yield W("frappe.auth.get_logged_user");(!o||o==="Guest")&&(window.location.href="/login?redirect-to=/planning")}catch(o){window.location.href="/login?redirect-to=/planning"}})),(o,d)=>{const h=J("router-view");return _(),p("div",null,[l(h)])}}};let j=Q(nt);X("resourceFetcher",Z);j.use(ot);j.use(Y);j.component("Button",b);j.mount("#app");
