var B=(y,u,n)=>new Promise((p,a)=>{var i=m=>{try{h(n.next(m))}catch(v){a(v)}},l=m=>{try{h(n.throw(m))}catch(v){a(v)}},h=m=>m.done?p(m.value):Promise.resolve(m.value).then(i,l);h((n=n.apply(y,u)).next())});import{u as P,r as E,a as M,c as D,b as w,o as N,d,e as g,f as e,g as c,w as x,h as t,B as b,i as z,A as $,j as k,k as U,v as G,_ as C,t as _,F,l as I,n as H,m as f,L as K,p as V,q as W,s as J,x as Q,y as X,z as Y,C as Z,D as ee,E as te}from"./vendor.js";const se=function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))p(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&p(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function p(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}};se();const oe={class:"p-5 max-w-[1400px] mx-auto bg-gray-50 min-h-screen font-sans"},ne={class:"flex justify-between items-center mb-5"},ae=e("div",null,[e("h1",{class:"text-xl font-bold text-gray-900"},"\u8BA1\u5212\u4EFB\u52A1\u770B\u677F"),e("p",{class:"text-xs text-gray-500 mt-1"},"\u5B9E\u65F6\u76D1\u63A7\u4EFB\u52A1\u6267\u884C\u4E0E\u5BA1\u6279\u72B6\u6001")],-1),re={class:"flex gap-2"},ie=f(" \u6570\u636E\u67E5\u770B "),le=f(" \u5237\u65B0 "),de={class:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm mb-5"},ce={class:"grid grid-cols-1 md:grid-cols-12 gap-4 items-end"},ue={class:"md:col-span-4 space-y-1"},_e=e("label",{class:"text-xs font-medium text-gray-500"},"\u5E97\u94FA\u7B5B\u9009",-1),pe={class:"md:col-span-4 space-y-1"},me=e("label",{class:"text-xs font-medium text-gray-500"},"\u8BA1\u5212\u4EFB\u52A1",-1),ge={class:"md:col-span-2 space-y-1"},he=e("label",{class:"text-xs font-medium text-gray-500"},"\u5BA1\u6279\u72B6\u6001",-1),fe=["disabled"],xe=e("option",{value:""},"\u5168\u90E8\u72B6\u6001",-1),ve=e("option",{value:"\u5F85\u5BA1\u6279"},"\u5F85\u5BA1\u6279",-1),be=e("option",{value:"\u5DF2\u901A\u8FC7"},"\u5DF2\u901A\u8FC7",-1),ye=e("option",{value:"\u5DF2\u9A73\u56DE"},"\u5DF2\u9A73\u56DE",-1),we=[xe,ve,be,ye],ke={class:"md:col-span-2 flex gap-2"},Ce=f(" \u67E5\u8BE2 "),Ve={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-5 mb-6"},je={class:"bg-white p-5 rounded-lg border border-gray-200 shadow-sm flex items-center"},ze={class:"w-12 h-12 rounded-lg bg-blue-50 text-blue-600 flex items-center justify-center mr-4 shrink-0"},Le={class:"text-2xl font-bold text-gray-900"},Be=e("div",{class:"text-xs text-gray-500 mt-1"},"\u8FDB\u884C\u4E2D\u8BA1\u5212",-1),De={class:"bg-white p-5 rounded-lg border border-gray-200 shadow-sm flex items-center"},Ne={class:"w-12 h-12 rounded-lg bg-green-50 text-green-600 flex items-center justify-center mr-4 shrink-0"},$e={class:"text-2xl font-bold text-gray-900"},Fe=e("div",{class:"text-xs text-gray-500 mt-1"},"\u5F85\u5904\u7406\u5E97\u94FA",-1),Ie={class:"bg-white border border-gray-200 rounded-lg shadow-sm"},Re={class:"border-b border-gray-200 px-5"},Se={class:"flex space-x-6","aria-label":"Tabs"},Te=["onClick"],Ae={class:"bg-gray-100 text-gray-600 px-2 py-0.5 rounded text-xs"},qe={class:"p-0 min-h-[300px]"},Oe={key:0,class:"flex flex-col items-center justify-center py-16 text-gray-400"},Pe=e("span",{class:"text-sm"},"\u52A0\u8F7D\u4E2D...",-1),Ee={key:1,class:"flex flex-col items-center justify-center py-16 text-gray-400"},Me=e("p",{class:"text-sm"},"\u6682\u65E0\u6570\u636E",-1),Ue={key:2,class:"divide-y divide-gray-100"},Ge=["onClick"],He={class:"flex items-center gap-4"},Ke={class:"w-10 h-10 rounded bg-gray-100 flex items-center justify-center text-lg font-bold text-gray-500 shrink-0 group-hover:bg-white group-hover:text-blue-600 border border-transparent group-hover:border-blue-100 transition-all"},We={class:"flex items-center gap-2 mb-1"},Je={class:"text-sm font-bold text-gray-900"},Qe=f("\u6025"),Xe={class:"flex items-center text-xs text-gray-400 gap-3"},Ye={class:"flex items-center gap-1"},Ze=e("span",null,"\u2022",-1),et={class:"text-right"},tt={class:"text-xs text-gray-400 mb-1"},st={class:"flex justify-end gap-2"},ot={setup(y){const u=P(),n=E({store_ids:[],task_ids:[],approval_status:""}),p=M("pending"),a=D({url:"product_sales_planning.planning_system.page.planning_dashboard.planning_dashboard.get_filter_options",auto:!0}),i=w(()=>{const o=a.data||{stores:[],tasks:[]};return{stores:o.stores.map(r=>({label:r.shop_name,value:r.name})),tasks:o.tasks.map(r=>({label:`${r.name} (${r.start_date||"\u65E0\u65E5\u671F"})`,value:r.name}))}}),l=D({url:"product_sales_planning.planning_system.page.planning_dashboard.planning_dashboard.get_dashboard_data",auto:!1,makeParams(){const o=n.store_ids.map(s=>s.value),r=n.task_ids.map(s=>s.value);return{filters:{store_ids:o,task_ids:r,approval_status:n.approval_status,tab:p.value}}}}),h=w(()=>{var o;return((o=l.data)==null?void 0:o.stats)||{}}),m=w(()=>{var o;return((o=l.data)==null?void 0:o.tasks)||[]}),v=w(()=>[{id:"pending",name:"\u5F85\u5B8C\u6210",count:h.value.pending_count||0},{id:"completed",name:"\u5DF2\u5B8C\u6210",count:h.value.completed_count||0}]);function L(o,r){if(!o||o==="\u672A\u5F00\u59CB")return"gray";if(r==="sub")return o.includes("\u5DF2\u63D0\u4EA4")?"blue":"orange";if(r==="app"){if(o.includes("\u901A\u8FC7"))return"green";if(o.includes("\u9A73\u56DE"))return"red";if(o.includes("\u5F85"))return"orange"}return"gray"}function R(){l.reload()}function S(){n.store_ids=[],n.task_ids=[],n.approval_status="",l.reload()}function T(o){p.value=o,o==="completed"&&(n.approval_status=""),l.reload()}function A(){window.location.href="/app/data-view"}function q(o){u.push({name:"StoreDetail",params:{storeId:o.store_id,parentId:o.parent_id}})}return N(()=>{l.reload()}),(o,r)=>(d(),g("div",oe,[e("div",ne,[ae,e("div",re,[c(t(b),{"icon-left":"table",variant:"outline",size:"sm",onClick:A},{default:x(()=>[ie]),_:1}),c(t(b),{"icon-left":"refresh-cw",variant:"outline",size:"sm",loading:t(l).loading,onClick:r[0]||(r[0]=s=>t(l).reload())},{default:x(()=>[le]),_:1},8,["loading"])])]),e("div",de,[e("div",ce,[e("div",ue,[_e,t(i).stores.length?(d(),z(t($),{key:0,placeholder:"\u9009\u62E9\u5E97\u94FA (\u53EF\u591A\u9009)...",options:t(i).stores,modelValue:t(n).store_ids,"onUpdate:modelValue":r[1]||(r[1]=s=>t(n).store_ids=s),multiple:"",size:"sm"},null,8,["options","modelValue"])):k("",!0)]),e("div",pe,[me,t(i).tasks.length?(d(),z(t($),{key:0,placeholder:"\u9009\u62E9\u4EFB\u52A1 (\u53EF\u591A\u9009)...",options:t(i).tasks,modelValue:t(n).task_ids,"onUpdate:modelValue":r[2]||(r[2]=s=>t(n).task_ids=s),multiple:"",size:"sm"},null,8,["options","modelValue"])):k("",!0)]),e("div",ge,[he,U(e("select",{"onUpdate:modelValue":r[3]||(r[3]=s=>t(n).approval_status=s),class:"form-select block w-full text-sm border-gray-200 rounded-md focus:border-blue-500 focus:ring-blue-500 h-[34px]",disabled:p.value==="completed"},we,8,fe),[[G,t(n).approval_status]])]),e("div",ke,[c(t(b),{variant:"solid",class:"w-full justify-center",size:"sm",onClick:R},{default:x(()=>[Ce]),_:1}),c(t(b),{icon:"x",variant:"ghost",size:"sm",onClick:S,title:"\u6E05\u7A7A\u7B5B\u9009"})])])]),t(h)?(d(),g("div",Ve,[e("div",je,[e("div",ze,[c(t(C),{name:"folder",class:"w-6 h-6"})]),e("div",null,[e("div",Le,_(t(h).ongoing||0),1),Be])]),e("div",De,[e("div",Ne,[c(t(C),{name:"check-square",class:"w-6 h-6"})]),e("div",null,[e("div",$e,_(t(h).tasks_count||0),1),Fe])])])):k("",!0),e("div",Ie,[e("div",Re,[e("nav",Se,[(d(!0),g(F,null,I(t(v),s=>(d(),g("button",{key:s.id,onClick:O=>T(s.id),class:H(["py-3 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors",p.value===s.id?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700"])},[f(_(s.name)+" ",1),e("span",Ae,_(s.count),1)],10,Te))),128))])]),e("div",qe,[t(l).loading?(d(),g("div",Oe,[c(t(K),{class:"mb-2"}),Pe])):t(m).length===0?(d(),g("div",Ee,[c(t(C),{name:"inbox",class:"w-8 h-8 text-gray-300 mb-2"}),Me])):(d(),g("div",Ue,[(d(!0),g(F,null,I(t(m),s=>(d(),g("div",{key:s.row_id,onClick:O=>q(s),class:"p-4 hover:bg-gray-50 cursor-pointer group flex items-center justify-between transition-colors"},[e("div",He,[e("div",Ke,_(s.title.charAt(0)),1),e("div",null,[e("div",We,[e("h3",Je,_(s.title),1),c(t(V),{theme:"gray",size:"sm"},{default:x(()=>[f(_(s.channel),1)]),_:2},1024),s.is_urgent?(d(),z(t(V),{key:0,theme:"red",size:"sm"},{default:x(()=>[Qe]),_:1})):k("",!0)]),e("div",Xe,[e("span",Ye,[c(t(C),{name:"user",class:"w-3 h-3"}),f(" "+_(s.user),1)]),Ze,e("span",null,_(s.plan_type),1)])])]),e("div",et,[e("div",tt,"\u622A\u6B62 "+_(s.deadline),1),e("div",st,[c(t(V),{theme:L(s.child_status,"sub")},{default:x(()=>[f(_(s.child_status),1)]),_:2},1032,["theme"]),c(t(V),{theme:L(s.approval_status,"app")},{default:x(()=>[f(_(s.approval_status),1)]),_:2},1032,["theme"])])])],8,Ge))),128))]))])])]))}},nt=[{path:"/",name:"Dashboard",component:ot}];let at=W({history:J("/planning/"),routes:nt});const rt={setup(y){return N(()=>B(this,null,function*(){try{const u=yield Q("frappe.auth.get_logged_user");(!u||u==="Guest")&&(window.location.href="/login?redirect-to=/planning")}catch(u){window.location.href="/login?redirect-to=/planning"}})),(u,n)=>{const p=X("router-view");return d(),g("div",null,[c(p)])}}};let j=Y(rt);Z("resourceFetcher",te);j.use(at);j.use(ee);j.component("Button",b);j.mount("#app");
